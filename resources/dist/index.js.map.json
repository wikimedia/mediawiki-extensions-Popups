{"version":3,"sources":["/w/extensions/Popups/webpack/bootstrap","/w/extensions/Popups/./node_modules/redux-thunk/dist/redux-thunk.js","/w/extensions/Popups/./node_modules/redux/dist/redux.js","/w/extensions/Popups/(webpack)/buildin/global.js","/w/extensions/Popups/(webpack)/buildin/module.js","/w/extensions/Popups/./src/actionTypes.js","/w/extensions/Popups/./src/actions.js","/w/extensions/Popups/./src/bracketedPixelRatio.js","/w/extensions/Popups/./src/changeListener.js","/w/extensions/Popups/./src/changeListeners/eventLogging.js","/w/extensions/Popups/./src/changeListeners/footerLink.js","/w/extensions/Popups/./src/changeListeners/index.js","/w/extensions/Popups/./src/changeListeners/linkTitle.js","/w/extensions/Popups/./src/changeListeners/pageviews.js","/w/extensions/Popups/./src/changeListeners/render.js","/w/extensions/Popups/./src/changeListeners/settings.js","/w/extensions/Popups/./src/changeListeners/statsv.js","/w/extensions/Popups/./src/changeListeners/syncUserSettings.js","/w/extensions/Popups/./src/constants.js","/w/extensions/Popups/./src/counts.js","/w/extensions/Popups/./src/experiments.js","/w/extensions/Popups/./src/formatter.js","/w/extensions/Popups/./src/gateway/mediawiki.js","/w/extensions/Popups/./src/gateway/page.js","/w/extensions/Popups/./src/gateway/reference.js","/w/extensions/Popups/./src/gateway/rest.js","/w/extensions/Popups/./src/gateway/restFormatters.js","/w/extensions/Popups/./src/getPageviewTracker.js","/w/extensions/Popups/./src/index.js","/w/extensions/Popups/./src/instrumentation/eventLogging.js","/w/extensions/Popups/./src/instrumentation/statsv.js","/w/extensions/Popups/./src/integrations/mwpopups.js","/w/extensions/Popups/./src/isEnabled.js","/w/extensions/Popups/./src/preview/model.js","/w/extensions/Popups/./src/previewBehavior.js","/w/extensions/Popups/./src/reducers/eventLogging.js","/w/extensions/Popups/./src/reducers/index.js","/w/extensions/Popups/./src/reducers/nextState.js","/w/extensions/Popups/./src/reducers/pageviews.js","/w/extensions/Popups/./src/reducers/preview.js","/w/extensions/Popups/./src/reducers/settings.js","/w/extensions/Popups/./src/reducers/statsv.js","/w/extensions/Popups/./src/title.js","/w/extensions/Popups/./src/trackExperimentsInteractions.js","/w/extensions/Popups/./src/ui/pointer-mask.svg","/w/extensions/Popups/./src/ui/renderer.js","/w/extensions/Popups/./src/ui/settingsDialog.js","/w/extensions/Popups/./src/ui/settingsDialogRenderer.js","/w/extensions/Popups/./src/ui/templates/pagePreview/pagePreview.js","/w/extensions/Popups/./src/ui/templates/pagePreviewWithButton/pagePreviewWithButton.js","/w/extensions/Popups/./src/ui/templates/pagePreviewWithImage/pagePreviewWithImage.js","/w/extensions/Popups/./src/ui/templates/pagePreviewWithTitle/pagePreviewWithTitle.js","/w/extensions/Popups/./src/ui/templates/popup/popup.js","/w/extensions/Popups/./src/ui/templates/preview/preview.js","/w/extensions/Popups/./src/ui/templates/referencePreview/referencePreview.js","/w/extensions/Popups/./src/ui/templates/settingsDialog/settingsDialog.js","/w/extensions/Popups/./src/ui/templates/templateUtil.js","/w/extensions/Popups/./src/ui/thumbnail.js","/w/extensions/Popups/./src/userSettings.js","/w/extensions/Popups/./src/wait.js"],"names":["BOOT","LINK_DWELL","ABANDON_START","ABANDON_END","LINK_CLICK","FETCH_START","FETCH_END","FETCH_COMPLETE","FETCH_FAILED","FETCH_ABORTED","PAGEVIEW_LOGGED","PREVIEW_DWELL","PREVIEW_SHOW","PREVIEW_CLICK","PREVIEW_SEEN","SETTINGS_SHOW","SETTINGS_HIDE","SETTINGS_CHANGE","EVENT_LOGGED","STATSV_LOGGED","$","jQuery","mw","mediaWiki","FETCH_START_DELAY","PREVIEW_SEEN_DURATION","FETCH_COMPLETE_TARGET_DELAY","FETCH_DELAY_REFERENCE_TYPE","ABANDON_END_DELAY","timedAction","baseAction","timestamp","now","boot","isEnabled","user","userSettings","config","url","editCount","get","previewCount","getPreviewCount","type","types","isNavPopupsEnabled","sessionToken","sessionId","pageToken","getPageviewToken","page","title","namespaceId","id","isAnon","getDwellDelay","previewTypes","TYPE_PAGE","TYPE_REFERENCE","fetch","gateway","el","token","titleText","getPrefixedDb","namespace","dispatch","xhr","fetchPreviewForTitle","promise","chain","then","result","catch","err","data","exception","Error","textStatus","when","wait","ex","showNullPreview","readyState","isNetworkError","createNullModel","getUrl","linkDwell","event","generateToken","getState","action","isNewInteraction","preview","activeToken","Deferred","resolve","previewState","enabled","abandon","abort","linkClick","previewDwell","previewShow","state","fetchResponse","currentToken","validType","TYPE_DISAMBIGUATION","indexOf","pageId","pageviewLogged","showSettings","hideSettings","saveSettings","wasEnabled","eventLogged","statsvLogged","dpr","window","devicePixelRatio","registerChangeListener","store","callback","subscribe","prevState","eventLogging","boundActions","eventLoggingTracker","getCurrentTimestamp","_","extend","baseData","createFooterLink","$link","append","attr","text","message","hide","$footer","length","parent","footerLink","$footerLink","undefined","on","e","preventDefault","settings","shouldShowFooterLink","show","linkTitle","pageviews","render","statsv","syncUserSettings","destroyTitleAttr","$el","restoreTitleAttr","hasPrevActiveLink","activeLink","pageviewTracker","pageview","source_page_id","source_namespace","source_title","source_url","previewBehavior","shouldShow","renderer","activeEvent","appendTo","document","body","setEnabled","showHelp","toggleHelp","track","syncIfChanged","setPreviewCount","setIsEnabled","reducer","prop","sync","current","bpr","bracketedPixelRatio","BRACKETED_DEVICE_PIXEL_RATIO","THUMBNAIL_SIZE","EXTRACT_LENGTH","exports","getEditCountBucket","count","bucket","getPreviewCountBucket","createExperiments","mwExperiments","weightedBoolean","name","trueWeight","getBucket","buckets","true","false","formatPlainTextExtract","plainTextExtract","extract","makeTitleInExtractBold","elements","boldIdentifier","Math","random","snip","replace","trim","escapedTitle","RegExp","escape","regExp","split","forEach","part","push","substring","createTextNode","CACHE_LIFETIME","createMediaWikiApiGateway","api","formatversion","redirects","exintro","exchars","explaintext","piprop","pithumbsize","pilicense","rvprop","inprop","titles","smaxage","maxage","uselang","headers","acceptLanguage","extractPageFromResponse","convertPageToModel","query","pages","formatter","createModel","canonicalurl","pagelanguagehtmlcode","pagelanguagedir","thumbnail","pageid","createPagePreviewGateway","gatewayConfig","constants","restConfig","endpoint","Api","createRESTBaseGateway","ajax","formatters","createReferenceGateway","scrapeReferenceText","idSelector","escapeSelector","scrapeReferenceType","$referenceText","find","each","index","nextType","className","getFragment","reject","model","html","referenceType","sourceElementId","parentNode","RESTBASE_PROFILE","extractParser","encodeURIComponent","Accept","jqXHR","errorThrown","isSafeImgFormat","filename","safeImage","test","generateThumbnailData","original","thumbSize","parts","source","lastPart","originalIsSafe","filenamePxIndex","substr","width","height","floor","join","Title","lang","dir","originalimage","parseHTMLResponse","extract_html","parseHTML","parsePlainTextResponse","titleCase","word","toUpperCase","slice","limitByEncodedURILength","sourceUrl","maxLength","truncatedUrl","every","char","prepareEventData","eventData","newFromText","page_title","getPageviewTracker","loader","trackerGetter","sendBeacon","topic","schema","dependencies","evLog","payload","prepare","makeBeaconUrl","getSendBeacon","navigatorObj","bind","createElement","src","BLACKLISTED_LINKS","getStatsvTracker","experiments","isStatsvEnabled","getEventLoggingTracker","isEventLoggingEnabled","performance","round","registerChangeListeners","actions","settingsDialog","statsvTracker","changeListeners","init","compose","Redux","generateRandomSessionId","pagePreviewGateway","referenceGateway","createUserSettings","storage","createSettingsDialogRenderer","using","eventLog","navigator","createIsEnabled","process","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","reducers","ReduxThunk","createPreviewBehavior","location","href","popups","createMediaWikiPopupsObject","invalidLinksSelector","validLinkSelector","rendererInit","mwTitle","titleFromElement","getPreviewType","bucketingRate","createMwPopups","hasIsEnabled","getIsEnabled","TYPE_GENERIC","languageCode","languageDirection","processedExtract","processExtract","previewType","getPagePreviewType","hasClass","settingsUrl","rawTitle","previewAbandon","click","getBaseData","bootAction","pageTitleSource","namespaceIdSource","pageIdSource","popupEnabled","previewCountBucket","counts","hovercardsSuppressedByGadget","editCountBucket","createEvent","interaction","actionData","linkInteractionToken","pageTitleHover","namespaceIdHover","timeToPreviewShow","perceivedWait","createClosingEvent","totalInteractionTime","finished","started","finalized","nextCount","newState","actionTypesWithTokens","actionTypes","nextState","link","isUserDwelling","updates","key","hasOwnProperty","page_id","page_namespace","fetchStartedAt","linkDwellStartedAt","isOwnPageAnchorLink","hash","host","pathname","search","getTitle","linkHref","Uri","hostname","queryLength","Object","keys","pattern","matches","exec","path","decodeURIComponent","fragment","isValid","contentNamespaces","fromElement","trackPopupClick","pathfinderPopupsExtVariant","pathfinderTracking","trackPopupsExt","trackPopupHover","$window","landscapePopupWidth","portraitPopupWidth","pointerSize","maxLinkWidthForCenteredPointer","createPointerMasks","container","pointerMaskSVG","createPreviewWithType","target","documentElement","getAttribute","createPagePreview","createDisambiguationPreview","createReferencePreview","createEmptyPreview","createThumbnail","hasThumbnail","renderPagePreview","isTall","createPagePreviewWithButton","renderPagePreviewWithButton","createPagePreviewWithTitle","renderPagePreviewWithTitle","createPagePreviewWithImage","renderPagePreviewWithImage","showTitle","extractMsg","msg","linkMsg","renderPreview","renderReferencePreview","behavior","layout","createLayout","pageX","pageY","clientY","clientRects","getClientRects","offset","scrollTop","layoutPreview","getClasses","SIZES","landscapeImage","h","first","trigger","bindBehavior","stopPropagation","trackExperimentsInteractions","timeoutId","setTimeout","clearTimeout","fadeInClass","fadeOutClass","removeClass","addClass","remove","isPreviewTall","linkData","windowData","flippedX","flippedY","offsetTop","getClosestYPosition","top","offsetLeft","clientTop","left","classes","predefinedLandscapeImageHeight","popup","css","outerHeight","setThumbnailClipPath","maskID","getThumbnailClipPathID","matrix","scaleX","translateX","min","portraitImage","w","mask","getElementById","setAttribute","y","rects","isTop","minY","Array","prototype","call","rect","deltaY","abs","bottom","ceil","createSettingsDialog","navPopupsEnabled","choices","description","isChecked","splice","renderSettingsDialog","heading","closeLabel","saveLabel","helpText","okLabel","$dialog","$overlay","selected","getSelectedSetting","visible","val","formSelectors","helpSelectors","pg","fn","disablePopups","defaultExtractWidth","escapeHTML","renderPopup","extractWidth","getExtractWidth","isNarrow","buttonSection","prepend","maxHeight","thumbHeight","$overflow","$title","$imageContainer","display","margin","position","KNOWN_TYPES","titleMsg","i","a","rel","element","scrolledToBottom","scrollHeight","clientHeight","isScrolling","toggleClass","escapeChoices","map","str","rawThumbnail","tall","thumbWidth","x","createThumbnailElement","thumbnailWidth","thumbnailHeight","nsSvg","nsXlink","line","createElementNS","points","$thumbnailSVGImage","setAttributeNS","$thumbnail","xmlns","IS_ENABLED_KEY","PREVIEW_COUNT_KEY","set","value","Boolean","parseInt","isNaN","toString","delay","deferred","timer"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;AClFA;AACA,IAAI,IAAyD;AAC7D;AACA,MAAM,EAK2B;AACjC,CAAC;AACD,oCAAoC;AACpC;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;;AAEA;;;AAGA,OAAO;AACP;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA,OAAO;AACP;AACA,CAAC;AACD,C;;;;;;;;;;;AC1FA;AACA,KAA4D;AAC5D,SAC8B;AAC9B,CAAC,4BAA4B;;AAE7B;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA,CAAC;AACD;AACA,CAAC;AACD;AACA,CAAC,UAAU,IAA6B;AACxC;AACA,CAAC,MAAM,EAEN;;AAED;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,WAAW,IAAI;AACf,aAAa,QAAQ;AACrB;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA,WAAW,IAAI;AACf;AACA;AACA;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA;AACA;AACA,aAAa,MAAM;AACnB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,eAAe,IAAI;AACnB;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB,eAAe,SAAS;AACxB;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,OAAO;AACpB;AACA;AACA;AACA;AACA;AACA,eAAe,OAAO;AACtB;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;;AAEA,mBAAmB,sBAAsB;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB,eAAe;AACf;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,eAAe,WAAW;AAC1B;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAAiB,OAAO;AACxB;AACA,mBAAmB,aAAa;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL,GAAG;AACH;AACA;;;AAGA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA,WAAW,OAAO;AAClB,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA,GAAG,aAAa;;AAEhB;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA,oEAAoE;AACpE;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA;;AAEA;AACA;AACA,KAAK;AACL;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,OAAO;AAClB;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,SAAS;AACtB;AACA;;;AAGA;AACA;AACA;;AAEA,iBAAiB,wBAAwB;AACzC;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA,oBAAoB,8BAA8B;AAClD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,gBAAgB;AAC3B;AACA;AACA;AACA,WAAW,SAAS;AACpB;AACA;AACA,aAAa,gBAAgB;AAC7B;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA,iBAAiB,iBAAiB;AAClC;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,GAAG;AACH;AACA;;AAEA;AACA;;AAEA;AACA,iBAAiB,sBAAsB;AACvC;AACA;;AAEA;AACA;AACA;AACA,OAAO;AACP;;AAEA;AACA;AACA,KAAK;AACL;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,aAAa,SAAS;AACtB;AACA;AACA;AACA;AACA,sEAAsE,aAAa;AACnF;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW,YAAY;AACvB,aAAa,SAAS;AACtB;;AAEA;AACA,4EAA4E,aAAa;AACzF;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,6BAA6B;AAC7B;AACA,OAAO;AACP;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,8CAA8C,cAAc;;AAE5D,CAAC;;;;;;;;;;;;;AC5qBD;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C;;;;;;;;;;;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;;;;;;;ACrBA;AAAA;AACA;AACA;AAEe;AA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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"ReduxThunk\"] = factory();\n\telse\n\t\troot[\"ReduxThunk\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1);\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports) {\n\n\t'use strict';\n\n\texports.__esModule = true;\n\tfunction createThunkMiddleware(extraArgument) {\n\t  return function (_ref) {\n\t    var dispatch = _ref.dispatch,\n\t        getState = _ref.getState;\n\t    return function (next) {\n\t      return function (action) {\n\t        if (typeof action === 'function') {\n\t          return action(dispatch, getState, extraArgument);\n\t        }\n\n\t        return next(action);\n\t      };\n\t    };\n\t  };\n\t}\n\n\tvar thunk = createThunkMiddleware();\n\tthunk.withExtraArgument = createThunkMiddleware;\n\n\texports['default'] = thunk;\n\n/***/ })\n/******/ ])\n});\n;","(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\ntypeof define === 'function' && define.amd ? define(['exports'], factory) :\n(factory((global.Redux = {})));\n}(this, (function (exports) { 'use strict';\n\nfunction symbolObservablePonyfill(root) {\n\tvar result;\n\tvar Symbol = root.Symbol;\n\n\tif (typeof Symbol === 'function') {\n\t\tif (Symbol.observable) {\n\t\t\tresult = Symbol.observable;\n\t\t} else {\n\t\t\tresult = Symbol('observable');\n\t\t\tSymbol.observable = result;\n\t\t}\n\t} else {\n\t\tresult = '@@observable';\n\t}\n\n\treturn result;\n}\n\n/* global window */\n\nvar root;\n\nif (typeof self !== 'undefined') {\n  root = self;\n} else if (typeof window !== 'undefined') {\n  root = window;\n} else if (typeof global !== 'undefined') {\n  root = global;\n} else if (typeof module !== 'undefined') {\n  root = module;\n} else {\n  root = Function('return this')();\n}\n\nvar result = symbolObservablePonyfill(root);\n\n/**\n * These are private action types reserved by Redux.\n * For any unknown actions, you must return the current state.\n * If the current state is undefined, you must return the initial state.\n * Do not reference these action types directly in your code.\n */\nvar randomString = function randomString() {\n  return Math.random().toString(36).substring(7).split('').join('.');\n};\n\nvar ActionTypes = {\n  INIT: \"@@redux/INIT\" + randomString(),\n  REPLACE: \"@@redux/REPLACE\" + randomString(),\n  PROBE_UNKNOWN_ACTION: function PROBE_UNKNOWN_ACTION() {\n    return \"@@redux/PROBE_UNKNOWN_ACTION\" + randomString();\n  }\n};\n\n/**\n * @param {any} obj The object to inspect.\n * @returns {boolean} True if the argument appears to be a plain object.\n */\nfunction isPlainObject(obj) {\n  if (typeof obj !== 'object' || obj === null) return false;\n  var proto = obj;\n\n  while (Object.getPrototypeOf(proto) !== null) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  return Object.getPrototypeOf(obj) === proto;\n}\n\n/**\n * Creates a Redux store that holds the state tree.\n * The only way to change the data in the store is to call `dispatch()` on it.\n *\n * There should only be a single store in your app. To specify how different\n * parts of the state tree respond to actions, you may combine several reducers\n * into a single reducer function by using `combineReducers`.\n *\n * @param {Function} reducer A function that returns the next state tree, given\n * the current state tree and the action to handle.\n *\n * @param {any} [preloadedState] The initial state. You may optionally specify it\n * to hydrate the state from the server in universal apps, or to restore a\n * previously serialized user session.\n * If you use `combineReducers` to produce the root reducer function, this must be\n * an object with the same shape as `combineReducers` keys.\n *\n * @param {Function} [enhancer] The store enhancer. You may optionally specify it\n * to enhance the store with third-party capabilities such as middleware,\n * time travel, persistence, etc. The only store enhancer that ships with Redux\n * is `applyMiddleware()`.\n *\n * @returns {Store} A Redux store that lets you read the state, dispatch actions\n * and subscribe to changes.\n */\n\nfunction createStore(reducer, preloadedState, enhancer) {\n  var _ref2;\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'function' || typeof enhancer === 'function' && typeof arguments[3] === 'function') {\n    throw new Error('It looks like you are passing several store enhancers to ' + 'createStore(). This is not supported. Instead, compose them ' + 'together to a single function');\n  }\n\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\n    enhancer = preloadedState;\n    preloadedState = undefined;\n  }\n\n  if (typeof enhancer !== 'undefined') {\n    if (typeof enhancer !== 'function') {\n      throw new Error('Expected the enhancer to be a function.');\n    }\n\n    return enhancer(createStore)(reducer, preloadedState);\n  }\n\n  if (typeof reducer !== 'function') {\n    throw new Error('Expected the reducer to be a function.');\n  }\n\n  var currentReducer = reducer;\n  var currentState = preloadedState;\n  var currentListeners = [];\n  var nextListeners = currentListeners;\n  var isDispatching = false;\n\n  function ensureCanMutateNextListeners() {\n    if (nextListeners === currentListeners) {\n      nextListeners = currentListeners.slice();\n    }\n  }\n  /**\n   * Reads the state tree managed by the store.\n   *\n   * @returns {any} The current state tree of your application.\n   */\n\n\n  function getState() {\n    if (isDispatching) {\n      throw new Error('You may not call store.getState() while the reducer is executing. ' + 'The reducer has already received the state as an argument. ' + 'Pass it down from the top reducer instead of reading it from the store.');\n    }\n\n    return currentState;\n  }\n  /**\n   * Adds a change listener. It will be called any time an action is dispatched,\n   * and some part of the state tree may potentially have changed. You may then\n   * call `getState()` to read the current state tree inside the callback.\n   *\n   * You may call `dispatch()` from a change listener, with the following\n   * caveats:\n   *\n   * 1. The subscriptions are snapshotted just before every `dispatch()` call.\n   * If you subscribe or unsubscribe while the listeners are being invoked, this\n   * will not have any effect on the `dispatch()` that is currently in progress.\n   * However, the next `dispatch()` call, whether nested or not, will use a more\n   * recent snapshot of the subscription list.\n   *\n   * 2. The listener should not expect to see all state changes, as the state\n   * might have been updated multiple times during a nested `dispatch()` before\n   * the listener is called. It is, however, guaranteed that all subscribers\n   * registered before the `dispatch()` started will be called with the latest\n   * state by the time it exits.\n   *\n   * @param {Function} listener A callback to be invoked on every dispatch.\n   * @returns {Function} A function to remove this change listener.\n   */\n\n\n  function subscribe(listener) {\n    if (typeof listener !== 'function') {\n      throw new Error('Expected the listener to be a function.');\n    }\n\n    if (isDispatching) {\n      throw new Error('You may not call store.subscribe() while the reducer is executing. ' + 'If you would like to be notified after the store has been updated, subscribe from a ' + 'component and invoke store.getState() in the callback to access the latest state. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');\n    }\n\n    var isSubscribed = true;\n    ensureCanMutateNextListeners();\n    nextListeners.push(listener);\n    return function unsubscribe() {\n      if (!isSubscribed) {\n        return;\n      }\n\n      if (isDispatching) {\n        throw new Error('You may not unsubscribe from a store listener while the reducer is executing. ' + 'See https://redux.js.org/api-reference/store#subscribe(listener) for more details.');\n      }\n\n      isSubscribed = false;\n      ensureCanMutateNextListeners();\n      var index = nextListeners.indexOf(listener);\n      nextListeners.splice(index, 1);\n    };\n  }\n  /**\n   * Dispatches an action. It is the only way to trigger a state change.\n   *\n   * The `reducer` function, used to create the store, will be called with the\n   * current state tree and the given `action`. Its return value will\n   * be considered the **next** state of the tree, and the change listeners\n   * will be notified.\n   *\n   * The base implementation only supports plain object actions. If you want to\n   * dispatch a Promise, an Observable, a thunk, or something else, you need to\n   * wrap your store creating function into the corresponding middleware. For\n   * example, see the documentation for the `redux-thunk` package. Even the\n   * middleware will eventually dispatch plain object actions using this method.\n   *\n   * @param {Object} action A plain object representing what changed. It is\n   * a good idea to keep actions serializable so you can record and replay user\n   * sessions, or use the time travelling `redux-devtools`. An action must have\n   * a `type` property which may not be `undefined`. It is a good idea to use\n   * string constants for action types.\n   *\n   * @returns {Object} For convenience, the same action object you dispatched.\n   *\n   * Note that, if you use a custom middleware, it may wrap `dispatch()` to\n   * return something else (for example, a Promise you can await).\n   */\n\n\n  function dispatch(action) {\n    if (!isPlainObject(action)) {\n      throw new Error('Actions must be plain objects. ' + 'Use custom middleware for async actions.');\n    }\n\n    if (typeof action.type === 'undefined') {\n      throw new Error('Actions may not have an undefined \"type\" property. ' + 'Have you misspelled a constant?');\n    }\n\n    if (isDispatching) {\n      throw new Error('Reducers may not dispatch actions.');\n    }\n\n    try {\n      isDispatching = true;\n      currentState = currentReducer(currentState, action);\n    } finally {\n      isDispatching = false;\n    }\n\n    var listeners = currentListeners = nextListeners;\n\n    for (var i = 0; i < listeners.length; i++) {\n      var listener = listeners[i];\n      listener();\n    }\n\n    return action;\n  }\n  /**\n   * Replaces the reducer currently used by the store to calculate the state.\n   *\n   * You might need this if your app implements code splitting and you want to\n   * load some of the reducers dynamically. You might also need this if you\n   * implement a hot reloading mechanism for Redux.\n   *\n   * @param {Function} nextReducer The reducer for the store to use instead.\n   * @returns {void}\n   */\n\n\n  function replaceReducer(nextReducer) {\n    if (typeof nextReducer !== 'function') {\n      throw new Error('Expected the nextReducer to be a function.');\n    }\n\n    currentReducer = nextReducer;\n    dispatch({\n      type: ActionTypes.REPLACE\n    });\n  }\n  /**\n   * Interoperability point for observable/reactive libraries.\n   * @returns {observable} A minimal observable of state changes.\n   * For more information, see the observable proposal:\n   * https://github.com/tc39/proposal-observable\n   */\n\n\n  function observable() {\n    var _ref;\n\n    var outerSubscribe = subscribe;\n    return _ref = {\n      /**\n       * The minimal observable subscription method.\n       * @param {Object} observer Any object that can be used as an observer.\n       * The observer object should have a `next` method.\n       * @returns {subscription} An object with an `unsubscribe` method that can\n       * be used to unsubscribe the observable from the store, and prevent further\n       * emission of values from the observable.\n       */\n      subscribe: function subscribe(observer) {\n        if (typeof observer !== 'object' || observer === null) {\n          throw new TypeError('Expected the observer to be an object.');\n        }\n\n        function observeState() {\n          if (observer.next) {\n            observer.next(getState());\n          }\n        }\n\n        observeState();\n        var unsubscribe = outerSubscribe(observeState);\n        return {\n          unsubscribe: unsubscribe\n        };\n      }\n    }, _ref[result] = function () {\n      return this;\n    }, _ref;\n  } // When a store is created, an \"INIT\" action is dispatched so that every\n  // reducer returns their initial state. This effectively populates\n  // the initial state tree.\n\n\n  dispatch({\n    type: ActionTypes.INIT\n  });\n  return _ref2 = {\n    dispatch: dispatch,\n    subscribe: subscribe,\n    getState: getState,\n    replaceReducer: replaceReducer\n  }, _ref2[result] = observable, _ref2;\n}\n\n/**\n * Prints a warning in the console if it exists.\n *\n * @param {String} message The warning message.\n * @returns {void}\n */\nfunction warning(message) {\n  /* eslint-disable no-console */\n  if (typeof console !== 'undefined' && typeof console.error === 'function') {\n    console.error(message);\n  }\n  /* eslint-enable no-console */\n\n\n  try {\n    // This error was thrown as a convenience so that if you enable\n    // \"break on all exceptions\" in your console,\n    // it would pause the execution at this line.\n    throw new Error(message);\n  } catch (e) {} // eslint-disable-line no-empty\n\n}\n\nfunction getUndefinedStateErrorMessage(key, action) {\n  var actionType = action && action.type;\n  var actionDescription = actionType && \"action \\\"\" + String(actionType) + \"\\\"\" || 'an action';\n  return \"Given \" + actionDescription + \", reducer \\\"\" + key + \"\\\" returned undefined. \" + \"To ignore an action, you must explicitly return the previous state. \" + \"If you want this reducer to hold no value, you can return null instead of undefined.\";\n}\n\nfunction getUnexpectedStateShapeWarningMessage(inputState, reducers, action, unexpectedKeyCache) {\n  var reducerKeys = Object.keys(reducers);\n  var argumentName = action && action.type === ActionTypes.INIT ? 'preloadedState argument passed to createStore' : 'previous state received by the reducer';\n\n  if (reducerKeys.length === 0) {\n    return 'Store does not have a valid reducer. Make sure the argument passed ' + 'to combineReducers is an object whose values are reducers.';\n  }\n\n  if (!isPlainObject(inputState)) {\n    return \"The \" + argumentName + \" has unexpected type of \\\"\" + {}.toString.call(inputState).match(/\\s([a-z|A-Z]+)/)[1] + \"\\\". Expected argument to be an object with the following \" + (\"keys: \\\"\" + reducerKeys.join('\", \"') + \"\\\"\");\n  }\n\n  var unexpectedKeys = Object.keys(inputState).filter(function (key) {\n    return !reducers.hasOwnProperty(key) && !unexpectedKeyCache[key];\n  });\n  unexpectedKeys.forEach(function (key) {\n    unexpectedKeyCache[key] = true;\n  });\n  if (action && action.type === ActionTypes.REPLACE) return;\n\n  if (unexpectedKeys.length > 0) {\n    return \"Unexpected \" + (unexpectedKeys.length > 1 ? 'keys' : 'key') + \" \" + (\"\\\"\" + unexpectedKeys.join('\", \"') + \"\\\" found in \" + argumentName + \". \") + \"Expected to find one of the known reducer keys instead: \" + (\"\\\"\" + reducerKeys.join('\", \"') + \"\\\". Unexpected keys will be ignored.\");\n  }\n}\n\nfunction assertReducerShape(reducers) {\n  Object.keys(reducers).forEach(function (key) {\n    var reducer = reducers[key];\n    var initialState = reducer(undefined, {\n      type: ActionTypes.INIT\n    });\n\n    if (typeof initialState === 'undefined') {\n      throw new Error(\"Reducer \\\"\" + key + \"\\\" returned undefined during initialization. \" + \"If the state passed to the reducer is undefined, you must \" + \"explicitly return the initial state. The initial state may \" + \"not be undefined. If you don't want to set a value for this reducer, \" + \"you can use null instead of undefined.\");\n    }\n\n    if (typeof reducer(undefined, {\n      type: ActionTypes.PROBE_UNKNOWN_ACTION()\n    }) === 'undefined') {\n      throw new Error(\"Reducer \\\"\" + key + \"\\\" returned undefined when probed with a random type. \" + (\"Don't try to handle \" + ActionTypes.INIT + \" or other actions in \\\"redux/*\\\" \") + \"namespace. They are considered private. Instead, you must return the \" + \"current state for any unknown actions, unless it is undefined, \" + \"in which case you must return the initial state, regardless of the \" + \"action type. The initial state may not be undefined, but can be null.\");\n    }\n  });\n}\n/**\n * Turns an object whose values are different reducer functions, into a single\n * reducer function. It will call every child reducer, and gather their results\n * into a single state object, whose keys correspond to the keys of the passed\n * reducer functions.\n *\n * @param {Object} reducers An object whose values correspond to different\n * reducer functions that need to be combined into one. One handy way to obtain\n * it is to use ES6 `import * as reducers` syntax. The reducers may never return\n * undefined for any action. Instead, they should return their initial state\n * if the state passed to them was undefined, and the current state for any\n * unrecognized action.\n *\n * @returns {Function} A reducer function that invokes every reducer inside the\n * passed object, and builds a state object with the same shape.\n */\n\n\nfunction combineReducers(reducers) {\n  var reducerKeys = Object.keys(reducers);\n  var finalReducers = {};\n\n  for (var i = 0; i < reducerKeys.length; i++) {\n    var key = reducerKeys[i];\n\n    {\n      if (typeof reducers[key] === 'undefined') {\n        warning(\"No reducer provided for key \\\"\" + key + \"\\\"\");\n      }\n    }\n\n    if (typeof reducers[key] === 'function') {\n      finalReducers[key] = reducers[key];\n    }\n  }\n\n  var finalReducerKeys = Object.keys(finalReducers);\n  var unexpectedKeyCache;\n\n  {\n    unexpectedKeyCache = {};\n  }\n\n  var shapeAssertionError;\n\n  try {\n    assertReducerShape(finalReducers);\n  } catch (e) {\n    shapeAssertionError = e;\n  }\n\n  return function combination(state, action) {\n    if (state === void 0) {\n      state = {};\n    }\n\n    if (shapeAssertionError) {\n      throw shapeAssertionError;\n    }\n\n    {\n      var warningMessage = getUnexpectedStateShapeWarningMessage(state, finalReducers, action, unexpectedKeyCache);\n\n      if (warningMessage) {\n        warning(warningMessage);\n      }\n    }\n\n    var hasChanged = false;\n    var nextState = {};\n\n    for (var _i = 0; _i < finalReducerKeys.length; _i++) {\n      var _key = finalReducerKeys[_i];\n      var reducer = finalReducers[_key];\n      var previousStateForKey = state[_key];\n      var nextStateForKey = reducer(previousStateForKey, action);\n\n      if (typeof nextStateForKey === 'undefined') {\n        var errorMessage = getUndefinedStateErrorMessage(_key, action);\n        throw new Error(errorMessage);\n      }\n\n      nextState[_key] = nextStateForKey;\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey;\n    }\n\n    return hasChanged ? nextState : state;\n  };\n}\n\nfunction bindActionCreator(actionCreator, dispatch) {\n  return function () {\n    return dispatch(actionCreator.apply(this, arguments));\n  };\n}\n/**\n * Turns an object whose values are action creators, into an object with the\n * same keys, but with every function wrapped into a `dispatch` call so they\n * may be invoked directly. This is just a convenience method, as you can call\n * `store.dispatch(MyActionCreators.doSomething())` yourself just fine.\n *\n * For convenience, you can also pass a single function as the first argument,\n * and get a function in return.\n *\n * @param {Function|Object} actionCreators An object whose values are action\n * creator functions. One handy way to obtain it is to use ES6 `import * as`\n * syntax. You may also pass a single function.\n *\n * @param {Function} dispatch The `dispatch` function available on your Redux\n * store.\n *\n * @returns {Function|Object} The object mimicking the original object, but with\n * every action creator wrapped into the `dispatch` call. If you passed a\n * function as `actionCreators`, the return value will also be a single\n * function.\n */\n\n\nfunction bindActionCreators(actionCreators, dispatch) {\n  if (typeof actionCreators === 'function') {\n    return bindActionCreator(actionCreators, dispatch);\n  }\n\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\n    throw new Error(\"bindActionCreators expected an object or a function, instead received \" + (actionCreators === null ? 'null' : typeof actionCreators) + \". \" + \"Did you write \\\"import ActionCreators from\\\" instead of \\\"import * as ActionCreators from\\\"?\");\n  }\n\n  var keys = Object.keys(actionCreators);\n  var boundActionCreators = {};\n\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var actionCreator = actionCreators[key];\n\n    if (typeof actionCreator === 'function') {\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);\n    }\n  }\n\n  return boundActionCreators;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\n/**\n * Composes single-argument functions from right to left. The rightmost\n * function can take multiple arguments as it provides the signature for\n * the resulting composite function.\n *\n * @param {...Function} funcs The functions to compose.\n * @returns {Function} A function obtained by composing the argument functions\n * from right to left. For example, compose(f, g, h) is identical to doing\n * (...args) => f(g(h(...args))).\n */\nfunction compose() {\n  for (var _len = arguments.length, funcs = new Array(_len), _key = 0; _key < _len; _key++) {\n    funcs[_key] = arguments[_key];\n  }\n\n  if (funcs.length === 0) {\n    return function (arg) {\n      return arg;\n    };\n  }\n\n  if (funcs.length === 1) {\n    return funcs[0];\n  }\n\n  return funcs.reduce(function (a, b) {\n    return function () {\n      return a(b.apply(void 0, arguments));\n    };\n  });\n}\n\n/**\n * Creates a store enhancer that applies middleware to the dispatch method\n * of the Redux store. This is handy for a variety of tasks, such as expressing\n * asynchronous actions in a concise manner, or logging every action payload.\n *\n * See `redux-thunk` package as an example of the Redux middleware.\n *\n * Because middleware is potentially asynchronous, this should be the first\n * store enhancer in the composition chain.\n *\n * Note that each middleware will be given the `dispatch` and `getState` functions\n * as named arguments.\n *\n * @param {...Function} middlewares The middleware chain to be applied.\n * @returns {Function} A store enhancer applying the middleware.\n */\n\nfunction applyMiddleware() {\n  for (var _len = arguments.length, middlewares = new Array(_len), _key = 0; _key < _len; _key++) {\n    middlewares[_key] = arguments[_key];\n  }\n\n  return function (createStore) {\n    return function () {\n      var store = createStore.apply(void 0, arguments);\n\n      var _dispatch = function dispatch() {\n        throw new Error(\"Dispatching while constructing your middleware is not allowed. \" + \"Other middleware would not be applied to this dispatch.\");\n      };\n\n      var middlewareAPI = {\n        getState: store.getState,\n        dispatch: function dispatch() {\n          return _dispatch.apply(void 0, arguments);\n        }\n      };\n      var chain = middlewares.map(function (middleware) {\n        return middleware(middlewareAPI);\n      });\n      _dispatch = compose.apply(void 0, chain)(store.dispatch);\n      return _objectSpread({}, store, {\n        dispatch: _dispatch\n      });\n    };\n  };\n}\n\n/*\n * This is a dummy function to check if the function name has been altered by minification.\n * If the function has been minified and NODE_ENV !== 'production', warn the user.\n */\n\nfunction isCrushed() {}\n\nif (typeof isCrushed.name === 'string' && isCrushed.name !== 'isCrushed') {\n  warning('You are currently using minified code outside of NODE_ENV === \"production\". ' + 'This means that you are running a slower development build of Redux. ' + 'You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify ' + 'or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) ' + 'to ensure you have the correct code for your production build.');\n}\n\nexports.createStore = createStore;\nexports.combineReducers = combineReducers;\nexports.bindActionCreators = bindActionCreators;\nexports.applyMiddleware = applyMiddleware;\nexports.compose = compose;\nexports.__DO_NOT_USE__ActionTypes = ActionTypes;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","/**\n * @module actionTypes\n */\n\nexport default {\n\tBOOT: 'BOOT',\n\tLINK_DWELL: 'LINK_DWELL',\n\tABANDON_START: 'ABANDON_START',\n\tABANDON_END: 'ABANDON_END',\n\tLINK_CLICK: 'LINK_CLICK',\n\t/** Precedes a fetch. */\n\tFETCH_START: 'FETCH_START',\n\t/** Follows a successful fetch. */\n\tFETCH_END: 'FETCH_END',\n\t/** Follows a fetch regardless of whether it was successful. */\n\tFETCH_COMPLETE: 'FETCH_COMPLETE',\n\t/** Follows an unsuccessful fetch. */\n\tFETCH_FAILED: 'FETCH_FAILED',\n\t/** Follows an aborted fetch */\n\tFETCH_ABORTED: 'FETCH_ABORTED',\n\tPAGEVIEW_LOGGED: 'PAGEVIEW_LOGGED',\n\tPREVIEW_DWELL: 'PREVIEW_DWELL',\n\tPREVIEW_SHOW: 'PREVIEW_SHOW',\n\tPREVIEW_CLICK: 'PREVIEW_CLICK',\n\t/**\n\t\tOccurs when a preview has been opened for a significant amount of time and\n\t\tis assumed to have been viewed.\n\t*/\n\tPREVIEW_SEEN: 'PREVIEW_SEEN',\n\tSETTINGS_SHOW: 'SETTINGS_SHOW',\n\tSETTINGS_HIDE: 'SETTINGS_HIDE',\n\tSETTINGS_CHANGE: 'SETTINGS_CHANGE',\n\tEVENT_LOGGED: 'EVENT_LOGGED',\n\tSTATSV_LOGGED: 'STATSV_LOGGED'\n};\n","/**\n * @module actions\n */\n\nimport types from './actionTypes';\nimport wait from './wait';\nimport { createNullModel, previewTypes } from './preview/model';\n\nconst $ = jQuery,\n\tmw = mediaWiki,\n\n\t// See the following for context around this value.\n\t//\n\t// * https://phabricator.wikimedia.org/T161284\n\t// * https://phabricator.wikimedia.org/T70861#3129780\n\tFETCH_START_DELAY = 150, // ms.\n\n\t// The minimum time a preview must be open before we judge it\n\t// has been seen.\n\t// See https://phabricator.wikimedia.org/T184793\n\tPREVIEW_SEEN_DURATION = 1000, // ms\n\n\t// The delay after which a FETCH_COMPLETE action should be dispatched.\n\t//\n\t// If the API endpoint responds faster than 350 ms (or, say, the API\n\t// response is served from the UA's cache), then we introduce a delay of\n\t// 350 ms - t to make the preview delay consistent to the user. The total\n\t// delay from start to finish is 500 ms.\n\tFETCH_COMPLETE_TARGET_DELAY = 350 + FETCH_START_DELAY, // ms.\n\n\tFETCH_DELAY_REFERENCE_TYPE = 150, // ms.\n\n\tABANDON_END_DELAY = 300; // ms.\n\n/**\n * Mixes in timing information to an action.\n *\n * Warning: the `baseAction` parameter is modified and returned.\n *\n * @param {Object} baseAction\n * @return {Object}\n */\nfunction timedAction( baseAction ) {\n\tbaseAction.timestamp = mw.now();\n\n\treturn baseAction;\n}\n\n/**\n * Represents Page Previews booting.\n *\n * When a Redux store is created, the `@@INIT` action is immediately\n * dispatched to it. To avoid overriding the term, we refer to booting rather\n * than initializing.\n *\n * Page Previews persists critical pieces of information to local storage.\n * Since reading from and writing to local storage are synchronous, Page\n * Previews is booted when the browser is idle (using\n * [`mw.requestIdleCallback`](https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback))\n * so as not to impact latency-critical events.\n *\n * @param {boolean} isEnabled See `isEnabled.js`\n * @param {mw.user} user\n * @param {ext.popups.UserSettings} userSettings\n * @param {mw.Map} config The config of the MediaWiki client-side application,\n *  i.e. `mw.config`\n * @param {string} url url\n * @return {Object}\n */\nexport function boot(\n\tisEnabled,\n\tuser,\n\tuserSettings,\n\tconfig,\n\turl\n) {\n\tconst editCount = config.get( 'wgUserEditCount' ),\n\t\tpreviewCount = userSettings.getPreviewCount();\n\n\treturn {\n\t\ttype: types.BOOT,\n\t\tisEnabled,\n\t\tisNavPopupsEnabled: config.get( 'wgPopupsConflictsWithNavPopupGadget' ),\n\t\tsessionToken: user.sessionId(),\n\t\tpageToken: user.getPageviewToken(),\n\t\tpage: {\n\t\t\turl,\n\t\t\ttitle: config.get( 'wgTitle' ),\n\t\t\tnamespaceId: config.get( 'wgNamespaceNumber' ),\n\t\t\tid: config.get( 'wgArticleId' )\n\t\t},\n\t\tuser: {\n\t\t\tisAnon: user.isAnon(),\n\t\t\teditCount,\n\t\t\tpreviewCount\n\t\t}\n\t};\n}\n\n/**\n * Determines the delay before showing the preview when dwelling a link.\n *\n * @param {string} type\n * @return {number}\n */\nfunction getDwellDelay( type ) {\n\tswitch ( type ) {\n\t\tcase previewTypes.TYPE_PAGE:\n\t\t\treturn FETCH_COMPLETE_TARGET_DELAY - FETCH_START_DELAY;\n\t\tcase previewTypes.TYPE_REFERENCE:\n\t\t\treturn FETCH_DELAY_REFERENCE_TYPE;\n\t\tdefault:\n\t\t\treturn 0;\n\t}\n}\n\n/**\n * Represents Page Previews fetching data via the gateway.\n *\n * @param {Gateway} gateway\n * @param {mw.Title} title\n * @param {Element} el\n * @param {string} token The unique token representing the link interaction that\n *  triggered the fetch\n * @param {string} type\n * @return {Redux.Thunk}\n */\nexport function fetch( gateway, title, el, token, type ) {\n\tconst titleText = title.getPrefixedDb(),\n\t\tnamespaceId = title.namespace;\n\n\treturn ( dispatch ) => {\n\t\tconst xhr = gateway.fetchPreviewForTitle( title, el );\n\n\t\tdispatch( timedAction( {\n\t\t\ttype: types.FETCH_START,\n\t\t\tel,\n\t\t\ttitle: titleText,\n\t\t\tnamespaceId,\n\t\t\tpromise: xhr\n\t\t} ) );\n\n\t\tconst chain = xhr\n\t\t\t.then( ( result ) => {\n\t\t\t\tdispatch( timedAction( {\n\t\t\t\t\ttype: types.FETCH_END,\n\t\t\t\t\tel\n\t\t\t\t} ) );\n\n\t\t\t\treturn result;\n\t\t\t} )\n\t\t\t.catch( ( err, data ) => {\n\t\t\t\tconst exception = new Error( err );\n\t\t\t\tconst type = data && data.textStatus && data.textStatus === 'abort' ?\n\t\t\t\t\ttypes.FETCH_ABORTED : types.FETCH_FAILED;\n\n\t\t\t\texception.data = data;\n\t\t\t\tdispatch( {\n\t\t\t\t\ttype,\n\t\t\t\t\tel\n\t\t\t\t} );\n\t\t\t\t// Keep the request promise in a rejected status since it failed.\n\t\t\t\tthrow exception;\n\t\t\t} );\n\n\t\treturn $.when(\n\t\t\tchain,\n\t\t\twait( getDwellDelay( type ) )\n\t\t)\n\t\t\t.then( ( result ) => {\n\t\t\t\tdispatch( {\n\t\t\t\t\ttype: types.FETCH_COMPLETE,\n\t\t\t\t\tel,\n\t\t\t\t\tresult,\n\t\t\t\t\ttoken\n\t\t\t\t} );\n\t\t\t} )\n\t\t\t.catch( ( ex ) => {\n\t\t\t\tconst result = ex.data;\n\t\t\t\tlet showNullPreview = true;\n\t\t\t\t// All failures, except those due to being offline or network error,\n\t\t\t\t// should present \"There was an issue displaying this preview\".\n\t\t\t\t// e.g.:\n\t\t\t\t// - Show (timeout): data=\"http\" {xhr: {}, textStatus: \"timeout\",\n\t\t\t\t//   exception: \"timeout\"}\n\t\t\t\t// - Show (bad MW request): data=\"unknown_action\" {error: {}}\n\t\t\t\t// - Show (RB 4xx): data=\"http\" {xhr: {}, textStatus: \"error\",\n\t\t\t\t//   exception: \"Bad Request\"}\n\t\t\t\t// - Show (RB 5xx): data=\"http\" {xhr: {}, textStatus: \"error\",\n\t\t\t\t//   exception: \"Service Unavailable\"}\n\t\t\t\t// - Suppress (offline or network error): data=\"http\"\n\t\t\t\t//   result={xhr: {}, textStatus: \"error\", exception: \"\"}\n\t\t\t\t// - Abort: data=\"http\"\n\t\t\t\t//   result={xhr: {}, textStatus: \"abort\", exception: \"abort\"}\n\n\t\t\t\tif ( result && result.xhr && result.xhr.readyState === 0 ) {\n\t\t\t\t\tconst isNetworkError = result.textStatus === 'error' && result.exception === '';\n\t\t\t\t\tshowNullPreview = !( isNetworkError || result.textStatus === 'abort' );\n\t\t\t\t}\n\n\t\t\t\tif ( showNullPreview ) {\n\t\t\t\t\tdispatch( {\n\t\t\t\t\t\ttype: types.FETCH_COMPLETE,\n\t\t\t\t\t\tel,\n\t\t\t\t\t\tresult: createNullModel( titleText, title.getUrl() ),\n\t\t\t\t\t\ttoken\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t};\n}\n\n/**\n * Represents the user dwelling on a link, either by hovering over it with\n * their mouse or by focussing it using their keyboard or an assistive device.\n *\n * @param {mw.Title} title\n * @param {Element} el\n * @param {Event} event\n * @param {Gateway} gateway\n * @param {Function} generateToken\n * @param {string} type\n * @return {Redux.Thunk}\n */\nexport function linkDwell( title, el, event, gateway, generateToken, type ) {\n\tconst token = generateToken(),\n\t\ttitleText = title.getPrefixedDb(),\n\t\tnamespaceId = title.namespace;\n\n\treturn ( dispatch, getState ) => {\n\t\tconst promise = wait( FETCH_START_DELAY );\n\t\tconst action = timedAction( {\n\t\t\ttype: types.LINK_DWELL,\n\t\t\tel,\n\t\t\tevent,\n\t\t\ttoken,\n\t\t\ttitle: titleText,\n\t\t\tnamespaceId,\n\t\t\tpromise\n\t\t} );\n\n\t\tdispatch( action );\n\n\t\t// Has the new generated token been accepted?\n\t\tfunction isNewInteraction() {\n\t\t\treturn getState().preview.activeToken === token;\n\t\t}\n\n\t\tif ( !isNewInteraction() ) {\n\t\t\treturn $.Deferred().resolve().promise();\n\t\t}\n\n\t\treturn promise.then( () => {\n\t\t\tconst previewState = getState().preview;\n\n\t\t\tif ( previewState.enabled && isNewInteraction() ) {\n\t\t\t\treturn dispatch( fetch( gateway, title, el, token, type ) );\n\t\t\t}\n\t\t} );\n\t};\n}\n\n/**\n * Represents the user abandoning a link, either by moving their mouse away\n * from it or by shifting focus to another UI element using their keyboard or\n * an assistive device, or abandoning a preview by moving their mouse away\n * from it.\n *\n * @return {Redux.Thunk}\n */\nexport function abandon() {\n\treturn ( dispatch, getState ) => {\n\t\tconst { activeToken: token, promise } = getState().preview;\n\n\t\tif ( !token ) {\n\t\t\treturn $.Deferred().resolve().promise();\n\t\t}\n\n\t\t// Immediately abandon any outstanding fetch request. Do not wait.\n\t\tpromise.abort();\n\n\t\tdispatch( timedAction( {\n\t\t\ttype: types.ABANDON_START,\n\t\t\ttoken\n\t\t} ) );\n\n\t\treturn wait( ABANDON_END_DELAY )\n\t\t\t.then( () => {\n\t\t\t\tdispatch( {\n\t\t\t\t\ttype: types.ABANDON_END,\n\t\t\t\t\ttoken\n\t\t\t\t} );\n\t\t\t} );\n\t};\n}\n\n/**\n * Represents the user clicking on a link with their mouse, keyboard, or an\n * assistive device.\n *\n * @param {Element} el\n * @return {Object}\n */\nexport function linkClick( el ) {\n\treturn timedAction( {\n\t\ttype: types.LINK_CLICK,\n\t\tel\n\t} );\n}\n\n/**\n * Represents the user dwelling on a preview with their mouse.\n *\n * @return {Object}\n */\nexport function previewDwell() {\n\treturn {\n\t\ttype: types.PREVIEW_DWELL\n\t};\n}\n\n/**\n * Represents a preview being shown to the user.\n *\n * This action is dispatched by the `./changeListeners/render.js` change\n * listener.\n *\n * @param {string} token\n * @return {Object}\n */\nexport function previewShow( token ) {\n\treturn ( dispatch, getState ) => {\n\t\tdispatch(\n\t\t\ttimedAction( {\n\t\t\t\ttype: types.PREVIEW_SHOW,\n\t\t\t\ttoken\n\t\t\t} )\n\t\t);\n\n\t\treturn wait( PREVIEW_SEEN_DURATION )\n\t\t\t.then( () => {\n\t\t\t\tconst state = getState(),\n\t\t\t\t\tpreview = state.preview,\n\t\t\t\t\tfetchResponse = preview && preview.fetchResponse,\n\t\t\t\t\tcurrentToken = preview && preview.activeToken,\n\t\t\t\t\tvalidType = fetchResponse && [\n\t\t\t\t\t\tpreviewTypes.TYPE_PAGE,\n\t\t\t\t\t\tpreviewTypes.TYPE_DISAMBIGUATION\n\t\t\t\t\t].indexOf( fetchResponse.type ) > -1;\n\n\t\t\t\tif (\n\t\t\t\t\t// Check the pageview can still be associated with original event\n\t\t\t\t\tcurrentToken && currentToken === token &&\n\t\t\t\t\t// and the preview is still active and of type `page`\n\t\t\t\t\tfetchResponse && validType\n\t\t\t\t) {\n\t\t\t\t\tdispatch( {\n\t\t\t\t\t\ttype: types.PREVIEW_SEEN,\n\t\t\t\t\t\ttitle: fetchResponse.title,\n\t\t\t\t\t\tpageId: fetchResponse.pageId,\n\t\t\t\t\t\t// The existing version of summary endpoint does not\n\t\t\t\t\t\t// provide namespace information, but new version\n\t\t\t\t\t\t// will. Given we only show pageviews for main namespace\n\t\t\t\t\t\t// this is hardcoded until the newer version is available.\n\t\t\t\t\t\tnamespace: 0\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t} );\n\t};\n}\n\n/**\n * Represents the situation when a pageview has been logged\n * (see previewShow and PREVIEW_SEEN action type)\n *\n * @return {Object}\n */\nexport function pageviewLogged() {\n\treturn {\n\t\ttype: types.PAGEVIEW_LOGGED\n\t};\n}\n\n/**\n * Represents the user clicking either the \"Enable previews\" footer menu link,\n * or the \"cog\" icon that's present on each preview.\n *\n * @return {Object}\n */\nexport function showSettings() {\n\treturn {\n\t\ttype: types.SETTINGS_SHOW\n\t};\n}\n\n/**\n * Represents the user closing the settings dialog and saving their settings.\n *\n * @return {Object}\n */\nexport function hideSettings() {\n\treturn {\n\t\ttype: types.SETTINGS_HIDE\n\t};\n}\n\n/**\n * Represents the user saving their settings.\n *\n * N.B. This action returns a Redux.Thunk not because it needs to perform\n * asynchronous work, but because it needs to query the global state for the\n * current enabled state. In order to keep the enabled state in a single\n * place (the preview reducer), we query it and dispatch it as `wasEnabled`\n * so that other reducers (like settings) can act on it without having to\n * duplicate the `enabled` state locally.\n * See docs/adr/0003-keep-enabled-state-only-in-preview-reducer.md for more\n * details.\n *\n * @param {boolean} enabled if previews are enabled or not\n * @return {Redux.Thunk}\n */\nexport function saveSettings( enabled ) {\n\treturn ( dispatch, getState ) => {\n\t\tdispatch( {\n\t\t\ttype: types.SETTINGS_CHANGE,\n\t\t\twasEnabled: getState().preview.enabled,\n\t\t\tenabled\n\t\t} );\n\t};\n}\n\n/**\n * Represents the queued event being logged `changeListeners/eventLogging.js`\n * change listener.\n *\n * @param {Object} event\n * @return {Object}\n */\nexport function eventLogged( event ) {\n\treturn {\n\t\ttype: types.EVENT_LOGGED,\n\t\tevent\n\t};\n}\n\n/**\n * Represents the queued statsv event being logged.\n * See `mw.popups.changeListeners.statsv` change listener.\n *\n * @return {Object}\n */\nexport function statsvLogged() {\n\treturn {\n\t\ttype: types.STATSV_LOGGED\n\t};\n}\n","/**\n * @module bracketedPixelRatio\n */\n\n/**\n * Normalizes a user's device pixel ratio to either 1, 1.5, or 2.\n *\n * This is important when the server resizes images on the fly in order to\n * reduce the work it has to do for device pixel ratios that deviate from a\n * set of common ratios.\n *\n * Adapted from mediawiki/core /resources/src/jquery/jquery.hidpi.js\n *\n * @param {number} [dpr=window.devicePixelRatio]\n * @return {number} The bracketed device pixel ratio\n */\nexport default function ( dpr = window.devicePixelRatio ) {\n\tif ( !dpr ) {\n\t\t// Probably legacy browser so assume 1\n\t\treturn 1;\n\t}\n\n\tif ( dpr > 1.5 ) {\n\t\treturn 2;\n\t}\n\n\tif ( dpr > 1 ) {\n\t\treturn 1.5;\n\t}\n\n\treturn 1;\n}\n","/**\n * @module changeListener\n */\n\n/**\n * @typedef {Function} ext.popups.ChangeListener\n * @param {Object} prevState The previous state\n * @param {Object} state The current state\n */\n\n/**\n * Registers a change listener, which is bound to the\n * [store](http://redux.js.org/docs/api/Store.html).\n *\n * A change listener is a function that is only invoked when the state in the\n * [store](http://redux.js.org/docs/api/Store.html) changes. N.B. that there\n * may not be a 1:1 correspondence with actions being dispatched to the store\n * and the state in the store changing.\n *\n * See [Store#subscribe](http://redux.js.org/docs/api/Store.html#subscribe)\n * for more information about what change listeners may and may not do.\n *\n * @param {Redux.Store} store\n * @param {ext.popups.ChangeListener} callback\n * @return {void}\n */\nexport default function registerChangeListener( store, callback ) {\n\t// This function is based on the example in [the documentation for\n\t// Store#subscribe](http://redux.js.org/docs/api/Store.html#subscribe),\n\t// which was written by Dan Abramov.\n\n\tlet state;\n\n\tstore.subscribe( () => {\n\t\tconst prevState = state;\n\n\t\tstate = store.getState();\n\n\t\tif ( prevState !== state ) {\n\t\t\tcallback( prevState, state );\n\t\t}\n\t} );\n}\n","/**\n * @module changeListeners/eventLogging\n */\n\nconst $ = jQuery;\n\n/**\n * Creates an instance of the event logging change listener.\n *\n * When an event is enqueued it'll be logged using the schema. Since it's the\n * responsibility of Event Logging (and the UA) to deliver logged events,\n * `EVENT_LOGGED` is immediately dispatched rather than waiting for some\n * indicator of completion.\n *\n * @param {Object} boundActions\n * @param {EventTracker} eventLoggingTracker\n * @param {Function} getCurrentTimestamp\n * @return {ext.popups.ChangeListener}\n */\nexport default function eventLogging(\n\tboundActions, eventLoggingTracker, getCurrentTimestamp\n) {\n\treturn ( _, state ) => {\n\t\tconst eventLogging = state.eventLogging;\n\t\tlet event = eventLogging.event;\n\n\t\tif ( !event ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Per https://meta.wikimedia.org/wiki/Schema:Popups, the timestamp\n\t\t// property should be the time at which the event is logged and not the\n\t\t// time at which the interaction started.\n\t\t//\n\t\t// Rightly or wrongly, it's left as an exercise for the analyst to\n\t\t// calculate the time at which the interaction started as part of their\n\t\t// analyses, e.g. https://phabricator.wikimedia.org/T186016#4002923.\n\t\tevent = $.extend( true, {}, eventLogging.baseData, event, {\n\t\t\ttimestamp: getCurrentTimestamp()\n\t\t} );\n\n\t\teventLoggingTracker( 'event.Popups', event );\n\t\t// Dispatch the eventLogged action so that the state tree can be\n\t\t// cleared/updated.\n\t\tboundActions.eventLogged( event );\n\t};\n}\n","/**\n * @module changeListeners/footerLink\n */\n\nconst mw = mediaWiki,\n\t$ = jQuery;\n\n/**\n * Creates the link element and appends it to the footer element.\n *\n * The following elements are considered to be the footer element (highest\n * priority to lowest):\n *\n * # `#footer-places`\n * # `#f-list`\n * # The parent element of `#footer li`, which is either an `ol` or `ul`.\n *\n * @return {JQuery} The link element\n */\nfunction createFooterLink() {\n\tconst $link = $( '<li>' ).append(\n\t\t$( '<a>' )\n\t\t\t.attr( 'href', '#' )\n\t\t\t.text( mw.message( 'popups-settings-enable' ).text() )\n\t);\n\n\t// As yet, we don't know whether the link should be visible.\n\t$link.hide();\n\n\t// From https://en.wikipedia.org/wiki/MediaWiki:Gadget-ReferenceTooltips.js,\n\t// which was written by Yair rand <https://en.wikipedia.org/wiki/User:Yair_rand>.\n\t// eslint-disable-next-line no-jquery/no-global-selector\n\tlet $footer = $( '#footer-places, #f-list' );\n\n\tif ( $footer.length === 0 ) {\n\t\t// eslint-disable-next-line no-jquery/no-global-selector\n\t\t$footer = $( '#footer li' ).parent();\n\t}\n\n\t$footer.append( $link );\n\n\treturn $link;\n}\n\n/**\n * Creates an instance of the footer link change listener.\n *\n * The change listener covers the following behaviour:\n *\n * * The \"Enable previews\" link (the \"link\") is appended to the footer menu\n *   (see `createFooterLink` above).\n * * When Page Previews are disabled, then the link is shown; otherwise, the\n *   link is hidden.\n * * When the user clicks the link, then the `showSettings` bound action\n *   creator is called.\n *\n * @param {Object} boundActions\n * @return {ext.popups.ChangeListener}\n */\nexport default function footerLink( boundActions ) {\n\tlet $footerLink;\n\n\treturn ( prevState, state ) => {\n\t\tif ( $footerLink === undefined ) {\n\t\t\t$footerLink = createFooterLink();\n\t\t\t$footerLink.on( 'click', ( e ) => {\n\t\t\t\te.preventDefault();\n\t\t\t\tboundActions.showSettings();\n\t\t\t} );\n\t\t}\n\n\t\tif ( state.settings.shouldShowFooterLink ) {\n\t\t\t$footerLink.show();\n\t\t} else {\n\t\t\t$footerLink.hide();\n\t\t}\n\t};\n}\n","import footerLink from './footerLink';\nimport eventLogging from './eventLogging';\nimport linkTitle from './linkTitle';\nimport pageviews from './pageviews';\nimport render from './render';\nimport settings from './settings';\nimport statsv from './statsv';\nimport syncUserSettings from './syncUserSettings';\n\nexport default {\n\tfooterLink,\n\teventLogging,\n\tlinkTitle,\n\tpageviews,\n\trender,\n\tsettings,\n\tstatsv,\n\tsyncUserSettings\n};\n","const $ = jQuery;\n\n/**\n * Creates an instance of the link title change listener.\n *\n * While the user dwells on a link, then it becomes the active link. The\n * change listener will remove a link's `title` attribute while it's the\n * active link.\n *\n * @return {ext.popups.ChangeListener}\n */\nexport default function linkTitle() {\n\tlet title;\n\n\t/**\n\t * Destroys the title attribute of the element, storing its value in local\n\t * state so that it can be restored later (see `restoreTitleAttr`).\n\t *\n\t * @param {Element} el\n\t * @return {void}\n\t */\n\tfunction destroyTitleAttr( el ) {\n\t\tconst $el = $( el );\n\n\t\t// Has the user dwelled on a link? If we've already removed its title\n\t\t// attribute, then NOOP.\n\t\tif ( title ) {\n\t\t\treturn;\n\t\t}\n\n\t\ttitle = $el.attr( 'title' );\n\n\t\t$el.attr( 'title', '' );\n\t}\n\n\t/**\n\t * Restores the title attribute of the element.\n\t *\n\t * @param {Element} el\n\t * @return {void}\n\t */\n\tfunction restoreTitleAttr( el ) {\n\t\t$( el ).attr( 'title', title );\n\n\t\ttitle = undefined;\n\t}\n\n\treturn ( prevState, state ) => {\n\t\tconst hasPrevActiveLink = prevState && prevState.preview.activeLink;\n\n\t\tif ( !state.preview.enabled ) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ( hasPrevActiveLink ) {\n\t\t\t// Has the user dwelled on a link immediately after abandoning another\n\t\t\t// (remembering that the ABANDON_END action is delayed by\n\t\t\t// ~100 ms).\n\t\t\tif ( prevState.preview.activeLink !== state.preview.activeLink ) {\n\t\t\t\trestoreTitleAttr( prevState.preview.activeLink );\n\t\t\t}\n\t\t}\n\n\t\tif ( state.preview.activeLink ) {\n\t\t\tdestroyTitleAttr( state.preview.activeLink );\n\t\t}\n\t};\n}\n","/**\n * @module changeListeners/pageviews\n */\n\n/**\n * Creates an instance of the pageviews change listener.\n *\n * When a pageview enqueued it'll be logged using the VirtualPageView schema.\n * Note, it's the responsibility of Event Logging (and the UA) to\n * deliver logged events.\n *\n * @param {Object} boundActions\n * @param {EventTracker} pageviewTracker\n * @return {ext.popups.ChangeListener}\n */\nexport default function pageviews(\n\tboundActions, pageviewTracker\n) {\n\treturn ( _, state ) => {\n\t\tlet page;\n\t\tif ( state.pageviews && state.pageviews.pageview && state.pageviews.page ) {\n\t\t\tpage = state.pageviews.page;\n\t\t\tpageviewTracker( 'event.VirtualPageView', $.extend( {},\n\t\t\t\t{\n\t\t\t\t\t/* eslint-disable camelcase */\n\t\t\t\t\tsource_page_id: page.id,\n\t\t\t\t\tsource_namespace: page.namespaceId,\n\t\t\t\t\tsource_title: page.title,\n\t\t\t\t\tsource_url: page.url\n\t\t\t\t\t/* eslint-enable camelcase */\n\t\t\t\t},\n\t\t\t\tstate.pageviews.pageview )\n\t\t\t);\n\t\t\t// Clear the pageview now its been logged.\n\t\t\tboundActions.pageviewLogged();\n\t\t}\n\t};\n}\n","import * as renderer from '../ui/renderer';\n\n/**\n * Creates an instance of the render change listener.\n *\n * FIXME: Remove hard coupling with renderer, inject it as a parameter\n * * Wire it up in index.js\n * * Fix tests to remove require mocking\n *\n * @param {ext.popups.PreviewBehavior} previewBehavior\n * @return {ext.popups.ChangeListener}\n */\nexport default function render( previewBehavior ) {\n\tlet preview;\n\n\treturn ( prevState, state ) => {\n\t\tif ( state.preview.shouldShow && !preview ) {\n\t\t\tpreview = renderer.render( state.preview.fetchResponse );\n\t\t\tpreview.show(\n\t\t\t\tstate.preview.activeEvent,\n\t\t\t\tpreviewBehavior,\n\t\t\t\tstate.preview.activeToken\n\t\t\t);\n\t\t} else if ( !state.preview.shouldShow && preview ) {\n\t\t\tpreview.hide();\n\t\t\tpreview = undefined;\n\t\t}\n\t};\n}\n","/**\n * Creates an instance of the settings change listener.\n *\n * @param {Object} boundActions\n * @param {Object} render function that renders a jQuery el with the settings\n * @return {ext.popups.ChangeListener}\n */\nexport default function settings( boundActions, render ) {\n\tlet settings;\n\n\treturn ( prevState, state ) => {\n\t\tif ( !prevState ) {\n\t\t\t// Nothing to do on initialization\n\t\t\treturn;\n\t\t}\n\n\t\t// Update global modal visibility\n\t\tif (\n\t\t\tprevState.settings.shouldShow === false &&\n\t\t\tstate.settings.shouldShow === true\n\t\t) {\n\t\t\t// Lazily instantiate the settings UI\n\t\t\tif ( !settings ) {\n\t\t\t\tsettings = render( boundActions );\n\t\t\t\tsettings.appendTo( document.body );\n\t\t\t}\n\n\t\t\t// Update the UI settings with the current settings\n\t\t\tsettings.setEnabled( state.preview.enabled );\n\n\t\t\tsettings.show();\n\t\t} else if (\n\t\t\tprevState.settings.shouldShow === true &&\n\t\t\tstate.settings.shouldShow === false\n\t\t) {\n\t\t\tsettings.hide();\n\t\t}\n\n\t\t// Update help visibility\n\t\tif ( prevState.settings.showHelp !== state.settings.showHelp ) {\n\t\t\tsettings.toggleHelp( state.settings.showHelp );\n\t\t}\n\t};\n}\n","/**\n * Creates an instance of the statsv change listener.\n *\n * The listener will log events to StatsD via the [the \"StatsD timers and\n * counters\" analytics event protocol][0].\n *\n * [0]: https://github.com/wikimedia/mediawiki-extensions-WikimediaEvents/blob/29c864a0/modules/ext.wikimediaEvents.statsd.js\n *\n * @param {Object} boundActions\n * @param {EventTracker} track\n * @return {ext.popups.ChangeListener}\n */\nexport default function statsv( boundActions, track ) {\n\treturn ( _, state ) => {\n\t\tconst statsv = state.statsv;\n\n\t\tif ( statsv.action ) {\n\t\t\ttrack( statsv.action, statsv.data );\n\n\t\t\tboundActions.statsvLogged();\n\t\t}\n\t};\n}\n","/**\n * @module changeListeners/syncUserSettings\n */\n\n/**\n * Creates an instance of the user settings sync change listener.\n *\n * This change listener syncs certain parts of the state tree to user\n * settings when they change.\n *\n * Used for:\n *\n * * Enabled state: If the previews are enabled or disabled.\n * * Preview count: When the user dwells on a link for long enough that\n *   a preview is shown, then their preview count will be incremented (see\n *   `reducers/eventLogging.js`, and is persisted to local storage.\n *\n * @param {ext.popups.UserSettings} userSettings\n * @return {ext.popups.ChangeListener}\n */\nexport default function syncUserSettings( userSettings ) {\n\treturn ( prevState, state ) => {\n\t\tsyncIfChanged(\n\t\t\tprevState, state, 'eventLogging', 'previewCount',\n\t\t\tuserSettings.setPreviewCount\n\t\t);\n\t\tsyncIfChanged(\n\t\t\tprevState, state, 'preview', 'enabled',\n\t\t\tuserSettings.setIsEnabled\n\t\t);\n\n\t};\n}\n\n/**\n * Given a state tree, reducer and property, safely return the value of the\n * property if the reducer and property exist\n * @param {Object} state tree\n * @param {string} reducer key to access on the state tree\n * @param {string} prop key to access on the reducer key of the state tree\n * @return {*}\n */\nfunction get( state, reducer, prop ) {\n\treturn state[ reducer ] && state[ reducer ][ prop ];\n}\n\n/**\n * Calls a sync function if the property prop on the property reducer on\n * the state trees has changed value.\n * @param {Object} prevState\n * @param {Object} state\n * @param {string} reducer key to access on the state tree\n * @param {string} prop key to access on the reducer key of the state tree\n * @param {Function} sync function to be called with the newest value if\n * changed\n * @return {void}\n */\nfunction syncIfChanged( prevState, state, reducer, prop, sync ) {\n\tconst current = get( state, reducer, prop );\n\tif ( prevState && ( get( prevState, reducer, prop ) !== current ) ) {\n\t\tsync( current );\n\t}\n}\n","import bracketedPixelRatio from './bracketedPixelRatio';\n\nconst bpr = bracketedPixelRatio();\n\nexport default {\n\tBRACKETED_DEVICE_PIXEL_RATIO: bpr,\n\tTHUMBNAIL_SIZE: 320 * bpr,\n\tEXTRACT_LENGTH: 525\n};\n","/**\n * @module counts\n */\n\n/**\n * Gets the count bucket for the number of edits a user has made.\n *\n * The buckets are defined as part of\n * [the Popups schema](https://meta.wikimedia.org/wiki/Schema:Popups).\n *\n * Extracted from `mw.popups.schemaPopups.getEditCountBucket`.\n *\n * @param {number} count\n * @return {string}\n */\nexports.getEditCountBucket = function getEditCountBucket( count ) {\n\tlet bucket;\n\n\tif ( count === 0 ) {\n\t\tbucket = '0';\n\t} else if ( count >= 1 && count <= 4 ) {\n\t\tbucket = '1-4';\n\t} else if ( count >= 5 && count <= 99 ) {\n\t\tbucket = '5-99';\n\t} else if ( count >= 100 && count <= 999 ) {\n\t\tbucket = '100-999';\n\t} else if ( count >= 1000 ) {\n\t\tbucket = '1000+';\n\t}\n\n\treturn `${ bucket } edits`;\n};\n\n/**\n * Gets the count bucket for the number of previews a user has seen.\n *\n * If local storage isn't available - because the user has disabled it\n * or the browser doesn't support it - then \"unknown\" is returned.\n *\n * The buckets are defined as part of\n * [the Popups schema](https://meta.wikimedia.org/wiki/Schema:Popups).\n *\n * Extracted from `mw.popups.getPreviewCountBucket`.\n *\n * @param {number|null|string|boolean} [count]\n * @return {string}\n */\nexports.getPreviewCountBucket = function getPreviewCountBucket( count ) {\n\tlet bucket;\n\n\tif ( count === 0 ) {\n\t\tbucket = '0';\n\t} else if ( count >= 1 && count <= 4 ) {\n\t\tbucket = '1-4';\n\t} else if ( count >= 5 && count <= 20 ) {\n\t\tbucket = '5-20';\n\t} else if ( count >= 21 ) {\n\t\tbucket = '21+';\n\t}\n\n\treturn bucket !== undefined ? ( `${ bucket } previews` ) : 'unknown';\n};\n","/**\n * @module experiments\n */\n\n/**\n * @interface Experiments\n *\n * @global\n */\n\n/**\n * Creates a helper wrapper for the MediaWiki-provided\n * `mw.experiments#getBucket` bucketing function.\n *\n * @param {mw.experiments} mwExperiments The `mw.experiments` singleton instance\n * @return {Experiments}\n */\nexport default function createExperiments( mwExperiments ) {\n\treturn {\n\t\t/**\n\t\t * Gets whether something is true given a name and a token.\n\t\t *\n\t\t * @example\n\t\t * import createExperiments from './src/experiments';\n\t\t * const experiments = createExperiments( mw.experiments );\n\t\t * const isFooEnabled = experiments.weightedBoolean(\n\t\t *   'foo',\n\t\t *   10 / 100, // 10% of all unique tokens should have foo enabled.\n\t\t *   token\n\t\t * );\n\t\t *\n\t\t * @function\n\t\t * @name Experiments#weightedBoolean\n\t\t * @param {string} name The name of the thing. Since this is used as the\n\t\t *  name of the underlying experiment it should be unique to reduce the\n\t\t *  likelihood of collisions with other enabled experiments\n\t\t * @param {number} trueWeight A number between 0 and 1, representing the\n\t\t *  probability of the thing being true\n\t\t * @param {string} token A token associated with the user for the duration\n\t\t *  of the experiment\n\t\t * @return {boolean}\n\t\t */\n\t\tweightedBoolean( name, trueWeight, token ) {\n\t\t\treturn mwExperiments.getBucket( {\n\t\t\t\tenabled: true,\n\n\t\t\t\tname,\n\t\t\t\tbuckets: {\n\t\t\t\t\ttrue: trueWeight,\n\t\t\t\t\tfalse: 1 - trueWeight\n\t\t\t\t}\n\t\t\t}, token ) === 'true';\n\t\t}\n\t};\n}\n","const $ = jQuery,\n\tmw = mediaWiki;\n\n/**\n * Improves the plain text extracts\n * @param {string} plainTextExtract\n * @param {string} title\n * @return {Array}\n */\nexport function formatPlainTextExtract( plainTextExtract, title ) {\n\tlet extract = plainTextExtract;\n\tif ( plainTextExtract === undefined ) {\n\t\treturn [];\n\t}\n\n\t// After cleaning the extract it may have been blanked\n\tif ( extract.length === 0 ) {\n\t\treturn [];\n\t}\n\n\textract = makeTitleInExtractBold( extract, title );\n\treturn extract;\n}\n\n/**\n * Converts the extract into a list of elements, which correspond to fragments\n * of the extract. Fragments that match the title verbatim are wrapped in a\n * `<b>` element.\n *\n * Using the bolded elements of the extract of the page directly is covered by\n * [T141651](https://phabricator.wikimedia.org/T141651).\n *\n * Extracted from `mw.popups.renderer.article.getProcessedElements`.\n *\n * @param {string} extract\n * @param {string} title\n * @return {Array} A set of HTML Elements\n */\nfunction makeTitleInExtractBold( extract, title ) {\n\tconst elements = [],\n\t\tboldIdentifier = `<bi-${ Math.random() }>`,\n\t\tsnip = `<snip-${ Math.random() }>`;\n\n\ttitle = title.replace( /\\s+/g, ' ' ).trim(); // Remove extra white spaces\n\tconst escapedTitle = mw.RegExp.escape( title ); // Escape RegExp elements\n\tconst regExp = new RegExp( `(^|\\\\s)(${ escapedTitle })(|$)`, 'i' );\n\n\t// Remove text in parentheses along with the parentheses\n\textract = extract.replace( /\\s+/, ' ' ); // Remove extra white spaces\n\n\t// Make title bold in the extract text\n\t// As the extract is html escaped there can be no such string in it\n\t// Also, the title is escaped of RegExp elements thus can't have \"*\"\n\textract = extract.replace(\n\t\tregExp,\n\t\t`$1${ snip }${ boldIdentifier }$2${ snip }$3`\n\t);\n\textract = extract.split( snip );\n\n\textract.forEach( ( part ) => {\n\t\tif ( part.indexOf( boldIdentifier ) === 0 ) {\n\t\t\telements.push( $( '<b>' )\n\t\t\t\t.text( part.substring( boldIdentifier.length ) ) );\n\t\t} else {\n\t\t\telements.push( document.createTextNode( part ) );\n\t\t}\n\t} );\n\n\treturn elements;\n}\n","/**\n * @module gateway/mediawiki\n */\n\nimport { createModel } from '../preview/model';\nimport * as formatter from '../formatter';\n\n// Public and private cache lifetime (5 minutes)\n//\n// FIXME: Move this to src/constants.js.\nconst CACHE_LIFETIME = 300,\n\t$ = jQuery;\n\n/**\n * @typedef {Gateway} MediaWikiGateway\n * @prop {Function(object): object} extractPageFromResponse\n * @prop {Function(object): object} formatPlainTextExtract\n */\n\n/**\n * Creates an instance of the MediaWiki API gateway.\n *\n * @param {mw.Api} api\n * @param {Object} config Configuration that affects the major behavior of the\n *  gateway.\n * @param {number} config.THUMBNAIL_SIZE The length of the major dimension of\n *  the thumbnail.\n * @param {number} config.EXTRACT_LENGTH The maximum length, in characters,\n *  of the extract.\n * @param {string} config.acceptLanguage The accepted language sent in the\n *  header\n * @return {MediaWikiGateway}\n */\nexport default function createMediaWikiApiGateway( api, config ) {\n\tfunction fetch( title ) {\n\t\treturn api.get( {\n\t\t\taction: 'query',\n\t\t\tprop: 'info|extracts|pageimages|revisions|info',\n\t\t\tformatversion: 2,\n\t\t\tredirects: true,\n\t\t\texintro: true,\n\t\t\texchars: config.EXTRACT_LENGTH,\n\n\t\t\t// There is an added geometric limit on .mwe-popups-extract\n\t\t\t// so that text does not overflow from the card.\n\t\t\texplaintext: true,\n\n\t\t\tpiprop: 'thumbnail',\n\t\t\tpithumbsize: config.THUMBNAIL_SIZE,\n\t\t\tpilicense: 'any',\n\t\t\trvprop: 'timestamp',\n\t\t\tinprop: 'url',\n\t\t\ttitles: title,\n\t\t\tsmaxage: CACHE_LIFETIME,\n\t\t\tmaxage: CACHE_LIFETIME,\n\t\t\tuselang: 'content'\n\t\t}, {\n\t\t\theaders: {\n\t\t\t\t'X-Analytics': 'preview=1',\n\t\t\t\t'Accept-Language': config.acceptLanguage\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * @param {mw.Title} title\n\t * @returns {AbortPromise<PagePreviewModel>}\n\t */\n\tfunction fetchPreviewForTitle( title ) {\n\t\tconst xhr = fetch( title.getPrefixedDb() );\n\t\treturn xhr.then( ( data ) => {\n\t\t\tconst page = extractPageFromResponse( data );\n\t\t\tconst plainTextExtract = formatPlainTextExtract( page );\n\t\t\treturn convertPageToModel( plainTextExtract );\n\t\t} ).promise( {\n\t\t\tabort() {\n\t\t\t\txhr.abort();\n\t\t\t}\n\t\t} );\n\t}\n\n\treturn {\n\t\tfetch,\n\t\textractPageFromResponse,\n\t\tconvertPageToModel,\n\t\tfetchPreviewForTitle,\n\t\tformatPlainTextExtract\n\t};\n}\n\n/**\n * Extracts page data from the API response.\n *\n * @function\n * @name MediaWikiGateway#extractPageFromResponse\n * @param {Object} data The response\n * @throws {Error} If the response is empty or doesn't contain data about the\n *  page\n * @return {Object}\n */\nfunction extractPageFromResponse( data ) {\n\tif (\n\t\tdata.query &&\n\t\tdata.query.pages &&\n\t\tdata.query.pages.length\n\t) {\n\t\treturn data.query.pages[ 0 ];\n\t}\n\n\tthrow new Error( 'API response `query.pages` is empty.' );\n}\n\n/**\n * Make plain text nicer by applying formatter.\n *\n * @function\n * @name MediaWikiGateway#formatPlainTextExtract\n * @param {Object} data The response\n * @return {Object}\n */\nfunction formatPlainTextExtract( data ) {\n\tconst result = $.extend( {}, data );\n\tresult.extract = formatter.formatPlainTextExtract( data.extract, data.title );\n\treturn result;\n}\n\n/**\n * Converts the API response to a preview model.\n *\n * @function\n * @name MediaWikiGateway#convertPageToModel\n * @param {Object} page\n * @return {PagePreviewModel}\n */\nfunction convertPageToModel( page ) {\n\treturn createModel(\n\t\tpage.title,\n\t\tpage.canonicalurl,\n\t\tpage.pagelanguagehtmlcode,\n\t\tpage.pagelanguagedir,\n\t\tpage.extract,\n\t\tpage.type,\n\t\tpage.thumbnail,\n\t\tpage.pageid\n\t);\n}\n","/**\n * @module gateway/page\n */\n\nimport constants from '../constants';\nimport createMediaWikiApiGateway from './mediawiki';\nimport createRESTBaseGateway from './rest';\nimport * as formatters from './restFormatters';\n\nconst mw = mediaWiki,\n\t$ = jQuery;\n\n/**\n * Creates a page preview gateway with sensible values for the dependencies.\n *\n * @param {mw.Map} config\n * @return {Gateway}\n */\nexport default function createPagePreviewGateway( config ) {\n\tconst gatewayConfig = $.extend( {}, constants, {\n\t\tacceptLanguage: config.get( 'wgPageContentLanguage' )\n\t} );\n\tconst restConfig = $.extend( {}, gatewayConfig, {\n\t\tendpoint: config.get( 'wgPopupsRestGatewayEndpoint' )\n\t} );\n\tswitch ( config.get( 'wgPopupsGateway' ) ) {\n\t\tcase 'mwApiPlain':\n\t\t\treturn createMediaWikiApiGateway( new mw.Api(), gatewayConfig );\n\t\tcase 'restbasePlain':\n\t\t\treturn createRESTBaseGateway(\n\t\t\t\t$.ajax, restConfig, formatters.parsePlainTextResponse );\n\t\tcase 'restbaseHTML':\n\t\t\treturn createRESTBaseGateway(\n\t\t\t\t$.ajax, restConfig, formatters.parseHTMLResponse );\n\t\tdefault:\n\t\t\tthrow new Error( 'Unknown gateway' );\n\t}\n}\n","/**\n * @module gateway/reference\n */\n\nimport { previewTypes } from '../preview/model';\n\nconst $ = jQuery;\n\n/**\n * @return {Gateway}\n */\nexport default function createReferenceGateway() {\n\n\tfunction scrapeReferenceText( id ) {\n\t\tconst idSelector = `#${ $.escapeSelector( id ) }`;\n\n\t\t/**\n\t\t * Same alternative selectors with and without mw- as in the RESTbased endpoint.\n\t\t * @see https://phabricator.wikimedia.org/diffusion/GMOA/browse/master/lib/transformations/references/structureReferenceListContent.js$138\n\t\t */\n\t\treturn $( `${ idSelector } .mw-reference-text, ${ idSelector } .reference-text` );\n\t}\n\n\t/**\n\t * This extracts the type (e.g. \"web\") from one or more <cite> elements class name lists, as\n\t * long as these don't conflict. A \"citation\" class is always ignored. <cite> elements without\n\t * another class (other than \"citation\") are ignored as well.\n\t *\n\t * Note this might return multiple types, e.g. <cite class=\"web citation paywalled\"> will be\n\t * returned as \"web paywalled\". Validation must be done in the code consuming this.\n\t *\n\t * This duplicates the strict type detection from\n\t * @see https://phabricator.wikimedia.org/diffusion/GMOA/browse/master/lib/transformations/references/structureReferenceListContent.js$93\n\t *\n\t * @param {JQuery} $referenceText\n\t * @returns {string|null}\n\t */\n\tfunction scrapeReferenceType( $referenceText ) {\n\t\tlet type = null;\n\n\t\t$referenceText.find( 'cite[class]' ).each( function ( index, el ) {\n\t\t\tconst nextType = el.className.replace( /\\bcitation\\b\\s*/g, '' ).trim();\n\n\t\t\tif ( !type ) {\n\t\t\t\ttype = nextType;\n\t\t\t} else if ( nextType && nextType !== type ) {\n\t\t\t\ttype = null;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} );\n\n\t\treturn type;\n\t}\n\n\t/**\n\t * @param {mw.Title} title\n\t * @param {Element} el\n\t * @returns {AbortPromise<ReferencePreviewModel>}\n\t */\n\tfunction fetchPreviewForTitle( title, el ) {\n\t\t// Need to encode the fragment again as mw.Title returns it as decoded text\n\t\tconst id = title.getFragment().replace( / /g, '_' ),\n\t\t\t$referenceText = scrapeReferenceText( id );\n\n\t\tif ( !$referenceText.length ) {\n\t\t\treturn $.Deferred().reject(\n\t\t\t\t'Footnote not found',\n\t\t\t\t// Required to set `showNullPreview` to false and not open an error popup\n\t\t\t\t{ textStatus: 'abort', xhr: { readyState: 0 } }\n\t\t\t).promise( { abort() {} } );\n\t\t}\n\n\t\tconst model = {\n\t\t\turl: `#${ id }`,\n\t\t\textract: $referenceText.html(),\n\t\t\ttype: previewTypes.TYPE_REFERENCE,\n\t\t\treferenceType: scrapeReferenceType( $referenceText ),\n\t\t\tsourceElementId: el && el.parentNode && el.parentNode.id\n\t\t};\n\n\t\treturn $.Deferred().resolve( model ).promise( { abort() {} } );\n\t}\n\n\treturn {\n\t\tfetchPreviewForTitle\n\t};\n}\n","/**\n * @module gateway/rest\n */\n\nimport { createModel } from '../preview/model';\n\nconst RESTBASE_PROFILE = 'https://www.mediawiki.org/wiki/Specs/Summary/1.2.0',\n\tmw = mediaWiki,\n\t$ = jQuery;\n\n/** @typedef {Function(JQuery.AjaxSettings=): JQuery.jqXHR} Ajax */\n\n/**\n * Creates an instance of the RESTBase gateway.\n *\n * This gateway differs from the {@link MediaWikiGateway MediaWiki gateway} in\n * that it fetches page data from [the RESTBase page summary endpoint][0].\n *\n * [0]: https://en.wikipedia.org/api/rest_v1/#!/Page_content/get_page_summary_title\n *\n * @param {Ajax} ajax A function with the same signature as `jQuery.ajax`\n * @param {Object} config Configuration that affects the major behavior of the\n *  gateway.\n * @param {Function} extractParser A function that takes response and returns\n *  parsed extract\n * @return {Gateway}\n */\nexport default function createRESTBaseGateway( ajax, config, extractParser ) {\n\t/**\n\t * Fetches page data from [the RESTBase page summary endpoint][0].\n\t *\n\t * [0]: https://en.wikipedia.org/api/rest_v1/#!/Page_content/get_page_summary_title\n\t *\n\t * @function\n\t * @name RESTBaseGateway#fetch\n\t * @param {string} title\n\t * @return {JQuery.jqXHR}\n\t */\n\tfunction fetch( title ) {\n\t\tconst endpoint = config.endpoint;\n\n\t\treturn ajax( {\n\t\t\turl: endpoint + encodeURIComponent( title ),\n\t\t\theaders: {\n\t\t\t\tAccept: `application/json; charset=utf-8; profile=\"${ RESTBASE_PROFILE }\"`,\n\t\t\t\t'Accept-Language': config.acceptLanguage\n\t\t\t}\n\t\t} );\n\t}\n\n\t/**\n\t * @param {mw.Title} title\n\t * @returns {AbortPromise<PagePreviewModel>}\n\t */\n\tfunction fetchPreviewForTitle( title ) {\n\t\tconst titleText = title.getPrefixedDb(),\n\t\t\txhr = fetch( titleText );\n\t\treturn xhr.then( ( page ) => {\n\t\t\t// Endpoint response may be empty or simply missing a title.\n\t\t\tif ( !page || !page.title ) {\n\t\t\t\tpage = $.extend( true, page || {}, { title: titleText } );\n\t\t\t}\n\t\t\t// And extract may be omitted if empty string\n\t\t\tif ( page.extract === undefined ) {\n\t\t\t\tpage.extract = '';\n\t\t\t}\n\t\t\treturn convertPageToModel(\n\t\t\t\tpage, config.THUMBNAIL_SIZE, extractParser\n\t\t\t);\n\t\t} ).catch( ( jqXHR, textStatus, errorThrown ) => {\n\t\t\t// The client will choose how to handle these errors which may include\n\t\t\t// those due to HTTP 4xx and 5xx status. The rejection typing matches\n\t\t\t// fetch failures.\n\t\t\treturn $.Deferred().reject( 'http', {\n\t\t\t\txhr: jqXHR,\n\t\t\t\ttextStatus,\n\t\t\t\texception: errorThrown\n\t\t\t} );\n\t\t} ).promise( { abort() { xhr.abort(); } } );\n\t}\n\n\treturn {\n\t\tfetch,\n\t\tconvertPageToModel,\n\t\tfetchPreviewForTitle\n\t};\n}\n\n/**\n * Checks whether the `originalImage` property contains an image\n * format that's safe to render.\n * https://www.mediawiki.org/wiki/Help:Images#Supported_media_types_for_images\n *\n * @param {string} filename\n *\n * @return {boolean}\n */\nfunction isSafeImgFormat( filename ) {\n\tconst safeImage = new RegExp( /\\.(jpg|jpeg|png|gif)$/i );\n\treturn safeImage.test( filename );\n}\n\n/**\n * Resizes the thumbnail to the requested width, preserving its aspect ratio.\n *\n * The requested width is limited to that of the original image unless the image\n * is an SVG, which can be scaled infinitely.\n *\n * This function is only intended to mangle the pretty thumbnail URLs used on\n * Wikimedia Commons. Once [an official thumb API](https://phabricator.wikimedia.org/T66214)\n * is fully specified and implemented, this function can be made more general.\n *\n * @param {Object} thumbnail The thumbnail image\n * @param {Object} original The original image\n * @param {number} thumbSize The requested size\n * @return {{source: string, width: number, height: number}|undefined}\n */\nfunction generateThumbnailData( thumbnail, original, thumbSize ) {\n\tconst parts = thumbnail.source.split( '/' ),\n\t\tlastPart = parts[ parts.length - 1 ],\n\t\toriginalIsSafe = isSafeImgFormat( original.source ) || undefined;\n\n\t// The last part, the thumbnail's full filename, is in the following form:\n\t// ${width}px-${filename}.${extension}. Splitting the thumbnail's filename\n\t// makes this function resilient to the thumbnail not having the same\n\t// extension as the original image, which is definitely the case for SVG's\n\t// where the thumbnail's extension is .svg.png.\n\tconst filenamePxIndex = lastPart.indexOf( 'px-' );\n\tif ( filenamePxIndex === -1 ) {\n\t\t// The thumbnail size is not customizable. Presumably, RESTBase requested a\n\t\t// width greater than the original and so MediaWiki returned the original's\n\t\t// URL instead of a thumbnail compatible URL. An original URL does not have\n\t\t// a \"thumb\" path, e.g.:\n\t\t//\n\t\t//   https://upload.wikimedia.org/wikipedia/commons/a/aa/Red_Giant_Earth_warm.jpg\n\t\t//\n\t\t// Instead of:\n\t\t//\n\t\t//   https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Red_Giant_Earth_warm.jpg/512px-Red_Giant_Earth_warm.jpg\n\t\t//\n\t\t// Use the original if it's a supported image format.\n\t\treturn originalIsSafe && original;\n\t}\n\tconst filename = lastPart.substr( filenamePxIndex + 3 );\n\n\t// Scale the thumbnail's largest dimension.\n\tlet width, height;\n\tif ( thumbnail.width > thumbnail.height ) {\n\t\twidth = thumbSize;\n\t\theight = Math.floor( ( thumbSize / thumbnail.width ) * thumbnail.height );\n\t} else {\n\t\twidth = Math.floor( ( thumbSize / thumbnail.height ) * thumbnail.width );\n\t\theight = thumbSize;\n\t}\n\n\t// If the image isn't an SVG, then it shouldn't be scaled past its original\n\t// dimensions.\n\tif ( width >= original.width && filename.indexOf( '.svg' ) === -1 ) {\n\t\t// if the image format is not supported, it shouldn't be rendered.\n\t\treturn originalIsSafe && original;\n\t}\n\n\tparts[ parts.length - 1 ] = `${ width }px-${ filename }`;\n\n\treturn {\n\t\tsource: parts.join( '/' ),\n\t\twidth,\n\t\theight\n\t};\n}\n\n/**\n * Converts the API response to a preview model.\n *\n * @function\n * @name RESTBaseGateway#convertPageToModel\n * @param {Object} page\n * @param {number} thumbSize\n * @param {Function} extractParser\n * @return {PagePreviewModel}\n */\nexport function convertPageToModel( page, thumbSize, extractParser ) {\n\treturn createModel(\n\t\tpage.title,\n\t\tnew mw.Title( page.title ).getUrl(),\n\t\tpage.lang,\n\t\tpage.dir,\n\t\textractParser( page ),\n\t\tpage.type,\n\t\tpage.thumbnail ?\n\t\t\tgenerateThumbnailData(\n\t\t\t\tpage.thumbnail, page.originalimage, thumbSize\n\t\t\t) : undefined,\n\t\tpage.pageid\n\t);\n}\n","import * as formatter from '../formatter';\n\n/**\n * Prepare extract\n * @param {Object} page Rest response\n * @return {Array} An array of DOM Elements\n */\nexport function parseHTMLResponse( page ) {\n\tconst extract = page.extract_html;\n\n\treturn extract.length === 0 ? [] : $.parseHTML( extract );\n}\n\n/**\n * Prepare extract\n * @param {Object} page Rest response\n * @return {Array} An array of DOM Elements\n */\nexport function parsePlainTextResponse( page ) {\n\treturn formatter.formatPlainTextExtract( page.extract, page.title );\n}\n","/**\n * @module getPageviewTracker\n */\nconst mw = mediaWiki;\n/**\n * @typedef {Object} MwCodeLoader\n *\n * Loads code from the server to the client on demand.\n *\n * @param {array} dependencies to load\n * @return {JQuery.Deferred} resolving when the code is loaded and\n *   can be used by the client.\n *\n * @global\n */\n\n/**\n * Convert the first letter of a string to uppercase.\n *\n * @param {string} word\n * @return {string}\n */\nfunction titleCase( word ) {\n\treturn word[ 0 ].toUpperCase() + word.slice( 1 );\n}\n\n/**\n * Truncates a string to a maximum length based on its URI encoded value.\n *\n * @param {string} sourceUrl source string\n * @param {number} maxLength maximum length\n * @return {string} string is returned in the same encoding as the input\n */\nfunction limitByEncodedURILength( sourceUrl, maxLength ) {\n\tlet truncatedUrl = '';\n\n\tsourceUrl.split( '' ).every( ( char ) => {\n\t\treturn ( encodeURIComponent( truncatedUrl + char ).length < maxLength ) ?\n\t\t\t( truncatedUrl += char ) :\n\t\t\tfalse;\n\t} );\n\treturn truncatedUrl;\n}\n\n/**\n * Convert Title properties into mediawiki canonical form\n * and limit the length of source_url.\n *\n * @param {Object} eventData\n * @return {Object}\n */\nfunction prepareEventData( eventData ) {\n\tconst data = eventData;\n\t/* eslint-disable camelcase */\n\tdata.source_title = mw.Title.newFromText( eventData.source_title )\n\t\t.getPrefixedDb();\n\tdata.page_title = mw.Title.newFromText( eventData.page_title )\n\t\t.getPrefixedDb();\n\t// prevent source_url from exceeding varnish max-url size - T196904\n\tdata.source_url = limitByEncodedURILength( eventData.source_url, 1000 );\n\n\t/* eslint-enable camelcase */\n\treturn data;\n}\n\n/**\n * Gets the appropriate analytics event tracker for logging virtual pageviews.\n * Note this bypasses EventLogging in order to track virtual pageviews\n * for pages where the DNT header (do not track) has been added.\n * This is explained in https://phabricator.wikimedia.org/T187277.\n *\n * @param {Object} config\n * @param {MwCodeLoader} loader that can source code that obeys the\n *  EventLogging api specification.\n * @param {Function} trackerGetter when called returns an instance\n *  of MediaWiki's EventLogging client\n * @param {Function} sendBeacon see\n *  https://developer.mozilla.org/en-US/docs/Web/API/Navigator/sendBeacon\n * @return {EventTracker}\n */\nfunction getPageviewTracker( config, loader, trackerGetter, sendBeacon ) {\n\tconst pageviewTracker = function ( topic, eventData ) {\n\t\tconst schema = titleCase( topic.slice( topic.indexOf( '.' ) + 1 ) );\n\t\tconst dependencies = [ 'ext.eventLogging', `schema.${schema}` ];\n\t\treturn loader( dependencies ).then( function () {\n\t\t\tconst evLog = trackerGetter();\n\t\t\tconst payload = evLog.prepare( schema, prepareEventData( eventData ) );\n\t\t\tconst url = evLog.makeBeaconUrl( payload );\n\t\t\tsendBeacon( url );\n\t\t} );\n\t};\n\treturn config.get( 'wgPopupsVirtualPageViews' ) ? pageviewTracker : () => {};\n}\n\n/**\n * Gets a function that can asynchronously transfer a small amount of data\n * over HTTP to a web server.\n *\n * @param {Window.Navigator} navigatorObj\n * @return {Function}\n */\nfunction getSendBeacon( navigatorObj ) {\n\treturn navigatorObj.sendBeacon ?\n\t\tnavigatorObj.sendBeacon.bind( navigatorObj ) :\n\t\t( url ) => {\n\t\t\tdocument.createElement( 'img' ).src = url;\n\t\t};\n}\n\nexport { getSendBeacon, limitByEncodedURILength };\nexport default getPageviewTracker;\n","/**\n * @module popups\n */\n\nimport * as Redux from 'redux';\nimport * as ReduxThunk from 'redux-thunk';\n\nimport createPagePreviewGateway from './gateway/page';\nimport createReferenceGateway from './gateway/reference';\nimport createUserSettings from './userSettings';\nimport createPreviewBehavior from './previewBehavior';\nimport createSettingsDialogRenderer from './ui/settingsDialogRenderer';\nimport registerChangeListener from './changeListener';\nimport createIsEnabled from './isEnabled';\nimport { fromElement as titleFromElement } from './title';\nimport { init as rendererInit } from './ui/renderer';\nimport createExperiments from './experiments';\nimport { isEnabled as isStatsvEnabled } from './instrumentation/statsv';\nimport { isEnabled as isEventLoggingEnabled }\n\tfrom './instrumentation/eventLogging';\nimport changeListeners from './changeListeners';\nimport * as actions from './actions';\nimport reducers from './reducers';\nimport createMediaWikiPopupsObject from './integrations/mwpopups';\nimport getPageviewTracker, { getSendBeacon } from './getPageviewTracker';\nimport { previewTypes, getPreviewType } from './preview/model';\n\nconst mw = mediaWiki,\n\t$ = jQuery,\n\n\tBLACKLISTED_LINKS = [\n\t\t'.extiw',\n\t\t'.image',\n\t\t'.new',\n\t\t'.internal',\n\t\t'.external',\n\t\t'.mw-cite-backlink a',\n\t\t'.oo-ui-buttonedElement-button',\n\t\t'.cancelLink a'\n\t];\n\n/**\n * @typedef {Function} EventTracker\n *\n * An analytics event tracker, i.e. `mw.track`.\n *\n * @param {string} topic\n * @param {Object} data\n *\n * @global\n */\n\n/**\n * Gets the appropriate analytics event tracker for logging metrics to StatsD\n * via [the \"StatsD timers and counters\" analytics event protocol][0].\n *\n * If logging metrics to StatsD is enabled for the duration of the user's\n * session, then the appriopriate function is `mw.track`; otherwise it's\n * `() => {}`.\n *\n * [0]: https://github.com/wikimedia/mediawiki-extensions-WikimediaEvents/blob/29c864a0/modules/ext.wikimediaEvents.statsd.js\n *\n * @param {Object} user\n * @param {Object} config\n * @param {Experiments} experiments\n * @return {EventTracker}\n */\nfunction getStatsvTracker( user, config, experiments ) {\n\treturn isStatsvEnabled( user, config, experiments ) ? mw.track : () => {};\n}\n\n/**\n * Gets the appropriate analytics event tracker for logging EventLogging events\n * via [the \"EventLogging subscriber\" analytics event protocol][0].\n *\n * If logging EventLogging events is enabled for the duration of the user's\n * session, then the appriopriate function is `mw.track`; otherwise it's\n * `() => {}`.\n *\n * [0]: https://github.com/wikimedia/mediawiki-extensions-EventLogging/blob/d1409759/modules/ext.eventLogging.subscriber.js\n *\n * @param {Object} user\n * @param {Object} config\n * @param {Window} window\n * @return {EventTracker}\n */\nfunction getEventLoggingTracker( user, config, window ) {\n\treturn isEventLoggingEnabled(\n\t\tuser,\n\t\tconfig,\n\t\twindow\n\t) ? mw.track : () => {};\n}\n\n/**\n * Returns timestamp since the beginning of the current document's origin\n * as reported by `window.performance.now()`. See\n * https://developer.mozilla.org/en-US/docs/Web/API/DOMHighResTimeStamp#The_time_origin\n * for a detailed explanation of the time origin.\n *\n * The value returned by this function is used for [the `timestamp` property\n * of the Schema:Popups events sent by the EventLogging\n * instrumentation](./src/changeListeners/eventLogging.js).\n *\n * @return {number|null}\n */\nfunction getCurrentTimestamp() {\n\tif ( window.performance && window.performance.now ) {\n\t\t// return an integer; see T182000\n\t\treturn Math.round( window.performance.now() );\n\t}\n\treturn null;\n}\n\n/**\n * Subscribes the registered change listeners to the\n * [store](http://redux.js.org/docs/api/Store.html#store).\n *\n * @param {Redux.Store} store\n * @param {Object} actions\n * @param {UserSettings} userSettings\n * @param {Function} settingsDialog\n * @param {PreviewBehavior} previewBehavior\n * @param {EventTracker} statsvTracker\n * @param {EventTracker} eventLoggingTracker\n * @param {EventTracker} pageviewTracker\n * @param {Function} getCurrentTimestamp\n * @return {void}\n */\nfunction registerChangeListeners(\n\tstore, actions, userSettings, settingsDialog, previewBehavior,\n\tstatsvTracker, eventLoggingTracker, pageviewTracker, getCurrentTimestamp\n) {\n\tregisterChangeListener( store, changeListeners.footerLink( actions ) );\n\tregisterChangeListener( store, changeListeners.linkTitle() );\n\tregisterChangeListener( store, changeListeners.render( previewBehavior ) );\n\tregisterChangeListener(\n\t\tstore, changeListeners.statsv( actions, statsvTracker ) );\n\tregisterChangeListener(\n\t\tstore, changeListeners.syncUserSettings( userSettings ) );\n\tregisterChangeListener(\n\t\tstore, changeListeners.settings( actions, settingsDialog ) );\n\tregisterChangeListener(\n\t\tstore,\n\t\tchangeListeners.eventLogging(\n\t\t\tactions, eventLoggingTracker, getCurrentTimestamp\n\t\t) );\n\tregisterChangeListener( store,\n\t\tchangeListeners.pageviews( actions, pageviewTracker )\n\t);\n}\n\n/*\n * Initialize the application by:\n * 1. Initializing side-effects and \"services\"\n * 2. Creating the state store\n * 3. Binding the actions to such store\n * 4. Registering change listeners\n * 5. Triggering the boot action to bootstrap the system\n * 6. When the page content is ready:\n *   - Initializing the renderer\n *   - Binding hover and click events to the eligible links to trigger actions\n */\n( function init() {\n\tlet compose = Redux.compose;\n\tconst\n\t\t// So-called \"services\".\n\t\tgenerateToken = mw.user.generateRandomSessionId,\n\t\tpagePreviewGateway = createPagePreviewGateway( mw.config ),\n\t\treferenceGateway = createReferenceGateway(),\n\t\tuserSettings = createUserSettings( mw.storage ),\n\t\tsettingsDialog = createSettingsDialogRenderer(),\n\t\texperiments = createExperiments( mw.experiments ),\n\t\tstatsvTracker = getStatsvTracker( mw.user, mw.config, experiments ),\n\t\t// Virtual pageviews are always tracked.\n\t\tpageviewTracker = getPageviewTracker( mw.config,\n\t\t\tmw.loader.using,\n\t\t\t() => mw.eventLog,\n\t\t\tgetSendBeacon( window.navigator )\n\t\t),\n\t\teventLoggingTracker = getEventLoggingTracker(\n\t\t\tmw.user,\n\t\t\tmw.config,\n\t\t\twindow\n\t\t),\n\t\tisEnabled = createIsEnabled( mw.user, userSettings, mw.config );\n\n\t// If debug mode is enabled, then enable Redux DevTools.\n\tif ( mw.config.get( 'debug' ) === true ||\n\t\t/* global process */\n\t\tprocess.env.NODE_ENV !== 'production' ) {\n\t\t// eslint-disable-next-line no-underscore-dangle\n\t\tcompose = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\t}\n\n\tconst store = Redux.createStore(\n\t\tRedux.combineReducers( reducers ),\n\t\tcompose( Redux.applyMiddleware(\n\t\t\tReduxThunk.default\n\t\t) )\n\t);\n\tconst boundActions = Redux.bindActionCreators( actions, store.dispatch );\n\tconst previewBehavior = createPreviewBehavior( mw.user, boundActions );\n\n\tregisterChangeListeners(\n\t\tstore, boundActions, userSettings, settingsDialog,\n\t\tpreviewBehavior, statsvTracker, eventLoggingTracker,\n\t\tpageviewTracker,\n\t\tgetCurrentTimestamp\n\t);\n\n\tboundActions.boot(\n\t\tisEnabled,\n\t\tmw.user,\n\t\tuserSettings,\n\t\tmw.config,\n\t\twindow.location.href\n\t);\n\n\t/*\n\t * Register external interface exposing popups internals so that other\n\t * extensions can query it (T171287)\n\t */\n\tmw.popups = createMediaWikiPopupsObject( store );\n\n\tconst invalidLinksSelector = BLACKLISTED_LINKS.join( ', ' );\n\tlet validLinkSelector = `#mw-content-text a[href][title]:not(${ invalidLinksSelector })`;\n\tif ( mw.config.get( 'wgPopupsReferencePreviews' ) ) {\n\t\tvalidLinkSelector += ', #mw-content-text .reference > a[href*=\"#\"]';\n\t}\n\n\trendererInit();\n\n\t/*\n\t * Binding hover and click events to the eligible links to trigger actions\n\t */\n\t$( document )\n\t\t.on( 'mouseover keyup', validLinkSelector, function ( event ) {\n\t\t\tconst mwTitle = titleFromElement( this, mw.config );\n\t\t\tif ( !mwTitle ) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst type = getPreviewType( this, mw.config, mwTitle );\n\t\t\tlet gateway;\n\n\t\t\tswitch ( type ) {\n\t\t\t\tcase previewTypes.TYPE_PAGE:\n\t\t\t\t\tgateway = pagePreviewGateway;\n\t\t\t\t\tbreak;\n\t\t\t\tcase previewTypes.TYPE_REFERENCE:\n\t\t\t\t\tgateway = referenceGateway;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tboundActions.linkDwell( mwTitle, this, event, gateway, generateToken, type );\n\t\t} )\n\t\t.on( 'mouseout blur', validLinkSelector, function () {\n\t\t\tconst mwTitle = titleFromElement( this, mw.config );\n\n\t\t\tif ( mwTitle ) {\n\t\t\t\tboundActions.abandon();\n\t\t\t}\n\t\t} )\n\t\t.on( 'click', validLinkSelector, function () {\n\t\t\tconst mwTitle = titleFromElement( this, mw.config );\n\n\t\t\tif ( mwTitle ) {\n\t\t\t\tboundActions.linkClick( this );\n\t\t\t}\n\t\t} );\n}() );\n\nwindow.Redux = Redux;\nwindow.ReduxThunk = ReduxThunk;\n","/**\n * @module instrumentation/eventLogging\n */\n\n/**\n * Gets whether EventLogging logging is enabled for the duration of the user's\n * session.\n * If wgPopupsEventLogging is false this will return false unless debug=true has\n * been enabled.\n * However, if the UA doesn't support [the Beacon API][1], then bucketing is\n * disabled.\n *\n * [1]: https://w3c.github.io/beacon/\n *\n * @param {mw.user} user The `mw.user` singleton instance\n * @param {mw.Map} config The `mw.config` singleton instance\n * @param {Window} window\n * @return {boolean}\n */\nexport function isEnabled( user, config, window ) {\n\t// if debug mode is on, always enable event logging. @see T168847\n\tif ( config.get( 'debug' ) === true ) {\n\t\treturn true;\n\t}\n\n\tif ( !config.get( 'wgPopupsEventLogging' ) ) {\n\t\treturn false;\n\t}\n\n\tif (\n\t\t!window.navigator ||\n\t\t!window.navigator.sendBeacon\n\t) {\n\t\treturn false;\n\t}\n\n\treturn user.isAnon();\n}\n","/**\n * @module instrumentation/statsv\n */\n\n/**\n * Gets whether Graphite logging (via [the statsv HTTP endpoint][0]) is enabled\n * for the duration of the user's session. The bucketing rate is controlled by\n * `wgPopupsStatsvSamplingRate`.\n *\n * [0]: https://wikitech.wikimedia.org/wiki/Graphite#statsv\n *\n * @param {mw.user} user The `mw.user` singleton instance\n * @param {mw.Map} config The `mw.config` singleton instance\n * @param {Experiments} experiments\n * @return {boolean}\n */\nexport function isEnabled( user, config, experiments ) {\n\tconst bucketingRate = config.get( 'wgPopupsStatsvSamplingRate', 0 );\n\n\treturn experiments.weightedBoolean(\n\t\t'ext.Popups.statsv',\n\t\tbucketingRate,\n\t\tuser.sessionId()\n\t);\n}\n","/**\n * @module MediaWiki-Popups Integration\n */\n\n/**\n * This function provides a mw.popups object which can be used by 3rd party\n * to interact with Popups. Currently it allows only to read isEnabled flag.\n *\n * @param {Redux.Store} store Popups store\n * @return {Object} external Popups interface\n */\nexport default function createMwPopups( store ) {\n\treturn {\n\t\tisEnabled: function isEnabled() {\n\t\t\treturn store.getState().preview.enabled;\n\t\t}\n\t};\n\n}\n","/**\n * @module isEnabled\n */\n\n/**\n * Given the global state of the application, creates a function that gets\n * whether or not the user should have Page Previews enabled.\n *\n * Page Previews is disabled when the Navigation Popups gadget is enabled.\n *\n * If Page Previews is configured as a user preference, then the user must\n * either be logged in and have enabled the preference or be logged out and have\n * not disabled previews via the settings modal.\n *\n * @param {mw.user} user The `mw.user` singleton instance\n * @param {Object} userSettings An object returned by `userSettings.js`\n * @param {mw.Map} config\n *\n * @return {boolean}\n */\nexport default function isEnabled( user, userSettings, config ) {\n\tif ( config.get( 'wgPopupsConflictsWithNavPopupGadget' ) ) {\n\t\treturn false;\n\t}\n\n\tif ( !user.isAnon() ) {\n\t\treturn config.get( 'wgPopupsShouldSendModuleToUser' );\n\t}\n\n\tif ( !userSettings.hasIsEnabled() ) {\n\t\treturn true;\n\t}\n\n\treturn userSettings.getIsEnabled();\n}\n","/**\n * @module preview/model\n */\n\n/**\n * Page Preview types as defined in Schema:Popups\n * https://meta.wikimedia.org/wiki/Schema:Popups\n *\n * @constant {Object}\n */\nconst previewTypes = {\n\t/** Empty preview used in error situations */\n\tTYPE_GENERIC: 'generic',\n\t/** Standard page preview with or without thumbnail */\n\tTYPE_PAGE: 'page',\n\t/** Disambiguation page preview */\n\tTYPE_DISAMBIGUATION: 'disambiguation',\n\t/** Reference preview **/\n\tTYPE_REFERENCE: 'reference'\n};\n\nexport { previewTypes };\n\n/**\n * Preview Model\n *\n * @typedef {Object} PreviewModel\n * @property {string} url The canonical URL of the page being previewed\n * @property {string} type One of the previewTypes.TYPE_ constants.\n *\n * @global\n */\n\n/**\n * @typedef {Object} PagePreviewModel\n * @extends {PreviewModel}\n * @property {string} title\n * @property {Array|undefined} extract `undefined` if the extract isn't\n *  viable, e.g. if it's empty after having ellipsis and parentheticals\n *  removed; this can be used to present default or error states\n * @property {string} languageCode\n * @property {string} languageDirection Either \"ltr\" or \"rtl\", or an empty string if undefined.\n * @property {{source: string, width: number, height: number}|undefined} thumbnail\n * @property {number} pageId Currently not used by any known popup type.\n *\n * @global\n */\n\n/**\n * @typedef {Object} ReferencePreviewModel\n * @extends {PreviewModel}\n * @property {string} extract An HTML snippet, not necessarily with a single top-level node\n * @property {string} referenceType A type identifier, e.g. \"web\"\n * @property {string} sourceElementId ID of the parent element that triggered the preview\n *\n * @global\n */\n\n/**\n * Creates a page preview model.\n *\n * @param {string} title\n * @param {string} url The canonical URL of the page being previewed\n * @param {string} languageCode\n * @param {string} languageDirection Either \"ltr\" or \"rtl\"\n * @param {Array|undefined|null} extract\n * @param {string} type\n * @param {{source: string, width: number, height: number}|undefined} [thumbnail]\n * @param {number} [pageId]\n * @return {PagePreviewModel}\n */\nexport function createModel(\n\ttitle,\n\turl,\n\tlanguageCode,\n\tlanguageDirection,\n\textract,\n\ttype,\n\tthumbnail,\n\tpageId\n) {\n\tconst processedExtract = processExtract( extract ),\n\t\tpreviewType = getPagePreviewType( type, processedExtract );\n\n\treturn {\n\t\ttitle,\n\t\turl,\n\t\tlanguageCode,\n\t\tlanguageDirection,\n\t\textract: processedExtract,\n\t\ttype: previewType,\n\t\tthumbnail,\n\t\tpageId\n\t};\n}\n\n/**\n * Creates an empty page preview model.\n *\n * @param {string} title\n * @param {string} url\n * @return {PagePreviewModel}\n */\nexport function createNullModel( title, url ) {\n\treturn createModel( title, url, '', '', [], '' );\n}\n\n/**\n * Determines the applicable popup type based on title and link element.\n *\n * @param {Element} el\n * @param {mw.Map} config\n * @param {mw.Title} title\n * @return {string|null}\n */\nexport function getPreviewType( el, config, title ) {\n\tif ( title.getPrefixedDb() !== config.get( 'wgPageName' ) ) {\n\t\treturn previewTypes.TYPE_PAGE;\n\t}\n\n\t// The other selector can potentially pick up self-links with a class=\"reference\"\n\t// parent, but no fragment\n\tif ( title.getFragment() &&\n\t\tconfig.get( 'wgPopupsReferencePreviews' ) &&\n\t\t$( el ).parent().hasClass( 'reference' )\n\t) {\n\t\treturn previewTypes.TYPE_REFERENCE;\n\t}\n\n\treturn null;\n}\n\n/**\n * Processes the extract returned by the TextExtracts MediaWiki API query\n * module.\n *\n * If the extract is `undefined`, `null`, or empty, then `undefined` is\n * returned.\n *\n * @param {Array|undefined|null} extract\n * @return {Array|undefined} Array when extract is an not empty array, undefined\n *  otherwise\n */\nfunction processExtract( extract ) {\n\tif ( extract === undefined || extract === null || extract.length === 0 ) {\n\t\treturn undefined;\n\t}\n\treturn extract;\n}\n\n/**\n * Determines the page preview type based on whether or not:\n * a. Is the preview empty.\n * b. The preview type matches one of previewTypes.\n * c. Assume standard page preview if both above are false\n *\n * @param {string} type\n * @param {Array|undefined} [processedExtract]\n * @return {string} One of the previewTypes.TYPE_ constants.\n */\n\nfunction getPagePreviewType( type, processedExtract ) {\n\tif ( processedExtract === undefined ) {\n\t\treturn previewTypes.TYPE_GENERIC;\n\t}\n\n\tswitch ( type ) {\n\t\tcase previewTypes.TYPE_GENERIC:\n\t\tcase previewTypes.TYPE_DISAMBIGUATION:\n\t\tcase previewTypes.TYPE_PAGE:\n\t\t\treturn type;\n\t\tdefault:\n\t\t\t/**\n\t\t\t * Assume type=\"page\" if extract exists & not one of previewTypes.\n\t\t\t * Note:\n\t\t\t * - Restbase response includes \"type\" prop but other gateways don't.\n\t\t\t * - event-logging Schema:Popups requires type=\"page\" but restbase\n\t\t\t * provides type=\"standard\". Model must conform to event-logging schema.\n\t\t\t */\n\t\t\treturn previewTypes.TYPE_PAGE;\n\t}\n}\n","/**\n * @module previewBehaviour\n */\n\nconst mw = mediaWiki;\n\n/**\n * A collection of event handlers specific to how the user interacts with all\n * previews. The event handlers  are are agnostic to how/when they are bound\n * //but not to what they are bound//, i.e. the showSettings event handler is\n * written to be bound to either an `<a>` or `<button>` element.\n *\n * @typedef {Object} ext.popups.PreviewBehavior\n * @property {string} settingsUrl\n * @property {Function} showSettings\n * @property {Function} previewDwell\n * @property {Function} previewAbandon\n * @property {Function} previewShow\n * @property {Function} click handler for the entire preview\n */\n\n/**\n * Creates an instance of `ext.popups.PreviewBehavior`.\n *\n * If the user is logged out, then clicking the cog should show the settings\n * modal.\n *\n * If the user is logged in, then clicking the cog should send them to the\n * the \"Appearance\" tab otherwise.\n *\n * @param {mw.User} user\n * @param {Object} actions The action creators bound to the Redux store\n * @return {ext.popups.PreviewBehavior}\n */\nexport default function createPreviewBehavior( user, actions ) {\n\tlet settingsUrl, showSettings = () => {};\n\n\tif ( user.isAnon() ) {\n\t\tshowSettings = ( event ) => {\n\t\t\tevent.preventDefault();\n\n\t\t\tactions.showSettings();\n\t\t};\n\t} else {\n\t\tconst rawTitle = 'Special:Preferences#mw-prefsection-rendering';\n\n\t\tsettingsUrl = mw.Title.newFromText( rawTitle )\n\t\t\t.getUrl();\n\t}\n\n\treturn {\n\t\tsettingsUrl,\n\t\tshowSettings,\n\t\tpreviewDwell: actions.previewDwell,\n\t\tpreviewAbandon: actions.abandon,\n\t\tpreviewShow: actions.previewShow,\n\t\tclick: actions.linkClick\n\t};\n}\n","/**\n * @module reducers/eventLogging\n */\n\nimport actionTypes from '../actionTypes';\nimport nextState from './nextState';\nimport * as counts from '../counts';\n\n/**\n * Initialize the data that's shared between all events.\n *\n * @param {Object} bootAction\n * @return {Object}\n */\nfunction getBaseData( bootAction ) {\n\tconst result = {\n\t\tpageTitleSource: bootAction.page.title,\n\t\tnamespaceIdSource: bootAction.page.namespaceId,\n\t\tpageIdSource: bootAction.page.id,\n\t\tisAnon: bootAction.user.isAnon,\n\t\tpopupEnabled: bootAction.isEnabled,\n\t\tpageToken: bootAction.pageToken,\n\t\tsessionToken: bootAction.sessionToken,\n\t\tpreviewCountBucket: counts.getPreviewCountBucket(\n\t\t\tbootAction.user.previewCount\n\t\t),\n\t\thovercardsSuppressedByGadget: bootAction.isNavPopupsEnabled\n\t};\n\n\tif ( !bootAction.user.isAnon ) {\n\t\tresult.editCountBucket =\n\t\t\tcounts.getEditCountBucket( bootAction.user.editCount );\n\t}\n\n\treturn result;\n}\n\n/**\n * Takes data specific to the action and adds the following properties:\n *\n * * `linkInteractionToken`;\n * * `pageTitleHover` and `namespaceIdHover`; and\n * * `previewType` and `perceivedWait`, if a preview has been shown.\n *\n * The linkInteractionToken is renewed on each new preview dwelling unlike the pageToken which has a\n * lifespan tied to the pageview. It is erroneous to use the same linkInteractionToken across\n * multiple previews even if the previews are for the same link.\n *\n * @param {Object} interaction\n * @param {Object} actionData Data specific to the action, e.g. see\n *  {@link module:reducers/eventLogging~createClosingEvent `createClosingEvent`}\n * @return {Object}\n */\nfunction createEvent( interaction, actionData ) {\n\tactionData.linkInteractionToken = interaction.token;\n\tactionData.pageTitleHover = interaction.title;\n\tactionData.namespaceIdHover = interaction.namespaceId;\n\n\t// Has the preview been shown?\n\tif ( interaction.timeToPreviewShow !== undefined ) {\n\t\tactionData.previewType = interaction.previewType;\n\t\tactionData.perceivedWait = interaction.timeToPreviewShow;\n\t}\n\n\treturn actionData;\n}\n\n/**\n * Creates an event that, when mixed into the base data (see\n * {@link module:reducers/eventLogging~getBaseData `getBaseData`}), represents\n * the user abandoning a link or preview.\n *\n * Since the event should be logged when the user has either abandoned a link or\n * dwelled on a different link, we refer to these events as \"closing\" events as\n * the link interaction has finished and a new one will be created later.\n *\n * If the link interaction is finalized, then no closing event is created.\n *\n * @param {Object} interaction\n * @return {Object|undefined}\n */\nfunction createClosingEvent( interaction ) {\n\tconst actionData = {\n\t\ttotalInteractionTime:\n\t\t\tMath.round( interaction.finished - interaction.started )\n\t};\n\n\tif ( interaction.finalized ) {\n\t\treturn undefined;\n\t}\n\n\t// Has the preview been shown? If so, then, in the context of the\n\t// instrumentation, then the preview has been dismissed by the user\n\t// rather than the user has abandoned the link.\n\tactionData.action =\n\t\tinteraction.timeToPreviewShow ? 'dismissed' : 'dwelledButAbandoned';\n\n\treturn createEvent( interaction, actionData );\n}\n\n/**\n * Reducer for actions that may result in an event being logged with [the\n * Popups schema][0] via EventLogging.\n *\n * The complexity of this reducer reflects the complexity of [the schema][0],\n * which is compounded by the introduction of two delays introduced by the\n * system to provide reasonable performance and a consistent UX.\n *\n * The reducer must:\n *\n * * Accumulate the state required to log events. This state is\n *   referred to as \"the interaction state\" or \"the interaction\";\n * * Enforce the invariant that one event is logged per interaction;\n * * Defend against delayed actions being dispatched; and, as a direct\n *   consequence\n * * Handle transitioning from one interaction to another at the same time.\n *\n * Furthermore, we distinguish between \"finalizing\" and \"closing\" the current\n * interaction state. Since only one event should be logged per link\n * interaction, we say that the interaction state is *finalized* when an event\n * has been logged and is *closed* when a new interaction should be created.\n * In practice, the interaction state is only finalized when the user clicks a\n * link or a preview.\n *\n * [0]: https://meta.wikimedia.org/wiki/Schema:Popups\n *\n * @param {Object} state\n * @param {Object} action\n * @return {Object} The state resulting from reducing the action with the\n *  current state\n */\nexport default function eventLogging( state, action ) {\n\tlet nextCount, newState;\n\tconst actionTypesWithTokens = [\n\t\tactionTypes.FETCH_COMPLETE,\n\t\tactionTypes.ABANDON_END,\n\t\tactionTypes.PREVIEW_SHOW\n\t];\n\n\tif ( state === undefined ) {\n\t\tstate = {\n\t\t\tpreviewCount: undefined,\n\t\t\tbaseData: {},\n\t\t\tinteraction: undefined,\n\t\t\tevent: undefined\n\t\t};\n\t}\n\n\t// Was the action delayed? Then it requires a token to be reduced. Enforce\n\t// this here to avoid repetition and reduce nesting below.\n\tif (\n\t\tactionTypesWithTokens.indexOf( action.type ) !== -1 &&\n\t\t( !state.interaction || action.token !== state.interaction.token )\n\t) {\n\t\treturn state;\n\t}\n\n\t// If there is no interaction ongoing, ignore all actions except for:\n\t// * Application initialization\n\t// * New link dwells (which start a new interaction)\n\t// * Clearing queued events\n\t//\n\t// For example, after ctrl+clicking a link or preview, any other actions\n\t// until the new interaction should be ignored.\n\tif (\n\t\t!state.interaction &&\n\t\taction.type !== actionTypes.BOOT &&\n\t\taction.type !== actionTypes.LINK_DWELL &&\n\t\taction.type !== actionTypes.EVENT_LOGGED &&\n\t\taction.type !== actionTypes.SETTINGS_CHANGE\n\t) {\n\t\treturn state;\n\t}\n\tswitch ( action.type ) {\n\t\tcase actionTypes.BOOT:\n\t\t\treturn nextState( state, {\n\t\t\t\tpreviewCount: action.user.previewCount,\n\t\t\t\tbaseData: getBaseData( action ),\n\t\t\t\tevent: {\n\t\t\t\t\taction: 'pageLoaded'\n\t\t\t\t}\n\t\t\t} );\n\n\t\tcase actionTypes.EVENT_LOGGED:\n\t\t\tnewState = nextState( state, {\n\t\t\t\tevent: undefined\n\t\t\t} );\n\n\t\t\t// If an event was logged with an interaction token, and it is still\n\t\t\t// the current interaction, finish the interaction since logging is\n\t\t\t// the exit point of the state machine and an interaction should never\n\t\t\t// be logged twice.\n\t\t\tif (\n\t\t\t\taction.event.linkInteractionToken &&\n\t\t\t\tstate.interaction &&\n\t\t\t\t( action.event.linkInteractionToken === state.interaction.token )\n\t\t\t) {\n\t\t\t\tnewState.interaction = undefined;\n\t\t\t}\n\t\t\treturn newState;\n\n\t\tcase actionTypes.FETCH_COMPLETE:\n\t\t\treturn nextState( state, {\n\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\tpreviewType: action.result.type\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.PREVIEW_SHOW:\n\t\t\tnextCount = state.previewCount + 1;\n\n\t\t\treturn nextState( state, {\n\t\t\t\tpreviewCount: nextCount,\n\t\t\t\tbaseData: nextState( state.baseData, {\n\t\t\t\t\tpreviewCountBucket: counts.getPreviewCountBucket( nextCount )\n\t\t\t\t} ),\n\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\ttimeToPreviewShow:\n\t\t\t\t\t\tMath.round( action.timestamp - state.interaction.started )\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.LINK_DWELL:\n\n\t\t\t// Not a new interaction?\n\t\t\tif ( state.interaction && action.el === state.interaction.link ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\t\tisUserDwelling: true\n\t\t\t\t\t} )\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn nextState( state, {\n\t\t\t\t// TODO: Extract this object into a module that can be shared between\n\t\t\t\t// this and the preview reducer.\n\t\t\t\tinteraction: {\n\t\t\t\t\tlink: action.el,\n\t\t\t\t\ttitle: action.title,\n\t\t\t\t\tnamespaceId: action.namespaceId,\n\t\t\t\t\ttoken: action.token,\n\t\t\t\t\tstarted: action.timestamp,\n\n\t\t\t\t\tisUserDwelling: true\n\t\t\t\t},\n\n\t\t\t\t// Was the user interacting with another link? If so, then log the\n\t\t\t\t// abandoned event.\n\t\t\t\tevent: state.interaction ?\n\t\t\t\t\tcreateClosingEvent( state.interaction ) : undefined\n\t\t\t} );\n\n\t\tcase actionTypes.PREVIEW_DWELL:\n\t\t\treturn nextState( state, {\n\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\tisUserDwelling: true\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.LINK_CLICK:\n\t\t\treturn nextState( state, {\n\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\tfinalized: true\n\t\t\t\t} ),\n\t\t\t\tevent: createEvent( state.interaction, {\n\t\t\t\t\taction: 'opened',\n\t\t\t\t\ttotalInteractionTime:\n\t\t\t\t\t\tMath.round( action.timestamp - state.interaction.started )\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.ABANDON_START:\n\t\t\treturn nextState( state, {\n\t\t\t\tinteraction: nextState( state.interaction, {\n\t\t\t\t\tfinished: action.timestamp,\n\n\t\t\t\t\tisUserDwelling: false\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.ABANDON_END:\n\t\t\tif ( !state.interaction.isUserDwelling ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tinteraction: undefined,\n\t\t\t\t\tevent: createClosingEvent( state.interaction )\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\treturn state;\n\n\t\tcase actionTypes.SETTINGS_SHOW:\n\t\t\treturn nextState( state, {\n\t\t\t\tevent: createEvent( state.interaction, {\n\t\t\t\t\taction: 'tapped settings cog'\n\t\t\t\t} )\n\t\t\t} );\n\n\t\tcase actionTypes.SETTINGS_CHANGE:\n\t\t\tif ( action.wasEnabled && !action.enabled ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tevent: {\n\t\t\t\t\t\taction: 'disabled',\n\t\t\t\t\t\tpopupEnabled: false\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} else {\n\t\t\t\treturn state;\n\t\t\t}\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","import eventLogging from './eventLogging';\nimport pageviews from './pageviews';\nimport preview from './preview';\nimport settings from './settings';\nimport statsv from './statsv';\n\nexport default {\n\teventLogging,\n\tpageviews,\n\tpreview,\n\tsettings,\n\tstatsv\n};\n","/**\n * Creates the next state tree from the current state tree and some updates.\n *\n * N.B. OO.copy doesn't copy Element instances, whereas $.extend does.\n * However, OO.copy does copy properties whose values are undefined or null,\n * whereas $.extend doesn't. Since the state tree contains an Element instance\n * - the preview.activeLink property - and we want to copy undefined/null into\n * the state we need to manually iterate over updates and check with\n * hasOwnProperty to copy over to the new state.\n *\n * In [change listeners](/docs/change_listener.md), for example, we talk about\n * the previous state and the current state (the `prevState` and `state`\n * parameters, respectively). Since\n * [reducers](http://redux.js.org/docs/basics/Reducers.html) take the current\n * state and an action and make updates, \"next state\" seems appropriate.\n *\n * @param {Object} state\n * @param {Object} updates\n * @return {Object}\n */\nexport default function nextState( state, updates ) {\n\tconst result = {};\n\n\tfor ( const key in state ) {\n\t\tif ( state.hasOwnProperty( key ) && !updates.hasOwnProperty( key ) ) {\n\t\t\tresult[ key ] = state[ key ];\n\t\t}\n\t}\n\n\tfor ( const key in updates ) {\n\t\tif ( updates.hasOwnProperty( key ) ) {\n\t\t\tresult[ key ] = updates[ key ];\n\t\t}\n\t}\n\n\treturn result;\n}\n","/**\n * @module reducers/pageviews\n */\n\nimport actionTypes from '../actionTypes';\nimport nextState from './nextState';\n\n/**\n * Reducer for actions that queues and clears events for\n * being logged as virtual pageviews [0]\n *\n * [0]: https://meta.wikimedia.org/wiki/Schema:VirtualPageViews\n *\n * @param {Object} state\n * @param {Object} action\n * @return {Object} The state resulting from reducing the action with the\n *  current state\n */\nexport default function pageviews( state, action ) {\n\tif ( state === undefined ) {\n\t\tstate = {\n\t\t\tpageview: undefined\n\t\t};\n\t}\n\n\tswitch ( action.type ) {\n\t\tcase actionTypes.BOOT:\n\t\t\treturn nextState( state, {\n\t\t\t\tpage: action.page\n\t\t\t} );\n\t\tcase actionTypes.PAGEVIEW_LOGGED:\n\t\t\treturn nextState( state, {\n\t\t\t\tpageview: undefined\n\t\t\t} );\n\t\tcase actionTypes.PREVIEW_SEEN:\n\t\t\treturn nextState( state, {\n\t\t\t\tpageview: {\n\t\t\t\t\t/* eslint-disable camelcase */\n\t\t\t\t\tpage_title: action.title,\n\t\t\t\t\tpage_id: action.pageId,\n\t\t\t\t\tpage_namespace: action.namespace\n\t\t\t\t\t/* eslint-enable camelcase */\n\t\t\t\t}\n\t\t\t} );\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","import actionTypes from '../actionTypes';\nimport nextState from './nextState';\n\n/**\n * Reducer for actions that modify the state of the preview model\n *\n * @param {Object|undefined} state before action\n * @param {Object} action Redux action that modified state.\n *  Must have `type` property.\n * @return {Object} state after action\n */\nexport default function preview( state, action ) {\n\tif ( state === undefined ) {\n\t\tstate = {\n\t\t\tenabled: undefined,\n\t\t\tactiveLink: undefined,\n\t\t\tactiveEvent: undefined,\n\t\t\tactiveToken: '',\n\t\t\tshouldShow: false,\n\t\t\tisUserDwelling: false\n\t\t};\n\t}\n\n\tswitch ( action.type ) {\n\t\tcase actionTypes.BOOT:\n\t\t\treturn nextState( state, {\n\t\t\t\tenabled: action.isEnabled\n\t\t\t} );\n\n\t\tcase actionTypes.SETTINGS_CHANGE:\n\t\t\treturn nextState( state, {\n\t\t\t\tenabled: action.enabled\n\t\t\t} );\n\n\t\tcase actionTypes.LINK_DWELL:\n\t\t\t// New interaction\n\t\t\tif ( action.el !== state.activeLink ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tactiveLink: action.el,\n\t\t\t\t\tactiveEvent: action.event,\n\t\t\t\t\tactiveToken: action.token,\n\n\t\t\t\t\t// When the user dwells on a link with their keyboard, a preview is\n\t\t\t\t\t// renderered, and then dwells on another link, the ABANDON_END\n\t\t\t\t\t// action will be ignored.\n\t\t\t\t\t//\n\t\t\t\t\t// Ensure that all the preview is hidden.\n\t\t\t\t\tshouldShow: false,\n\n\t\t\t\t\tisUserDwelling: true,\n\t\t\t\t\tpromise: action.promise\n\t\t\t\t} );\n\t\t\t}\n\t\t\t// Dwelling back into the same link\n\t\t\treturn nextState( state, {\n\t\t\t\tisUserDwelling: true\n\t\t\t} );\n\n\t\tcase actionTypes.ABANDON_END:\n\t\t\tif ( action.token === state.activeToken && !state.isUserDwelling ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tactiveLink: undefined,\n\t\t\t\t\tactiveToken: undefined,\n\t\t\t\t\tactiveEvent: undefined,\n\t\t\t\t\tfetchResponse: undefined,\n\t\t\t\t\tshouldShow: false\n\t\t\t\t} );\n\t\t\t}\n\t\t\treturn state;\n\n\t\tcase actionTypes.PREVIEW_DWELL:\n\t\t\treturn nextState( state, {\n\t\t\t\tisUserDwelling: true\n\t\t\t} );\n\n\t\tcase actionTypes.ABANDON_START:\n\t\t\treturn nextState( state, {\n\t\t\t\tisUserDwelling: false\n\t\t\t} );\n\n\t\tcase actionTypes.FETCH_START:\n\t\t\treturn nextState( state, {\n\t\t\t\tfetchResponse: undefined,\n\t\t\t\tpromise: action.promise\n\t\t\t} );\n\n\t\tcase actionTypes.FETCH_COMPLETE:\n\t\t\tif ( action.token === state.activeToken ) {\n\t\t\t\treturn nextState( state, {\n\t\t\t\t\tfetchResponse: action.result,\n\t\t\t\t\tshouldShow: state.isUserDwelling\n\t\t\t\t} );\n\t\t\t} // else fall through\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","import actionTypes from '../actionTypes';\nimport nextState from './nextState';\n\n/**\n * Reducer for actions that modify the state of the settings\n *\n * @param {Object} state\n * @param {Object} action\n * @return {Object} state after action\n */\nexport default function settings( state, action ) {\n\tif ( state === undefined ) {\n\t\tstate = {\n\t\t\tshouldShow: false,\n\t\t\tshowHelp: false,\n\t\t\tshouldShowFooterLink: false\n\t\t};\n\t}\n\n\tswitch ( action.type ) {\n\t\tcase actionTypes.SETTINGS_SHOW:\n\t\t\treturn nextState( state, {\n\t\t\t\tshouldShow: true,\n\t\t\t\tshowHelp: false\n\t\t\t} );\n\t\tcase actionTypes.SETTINGS_HIDE:\n\t\t\treturn nextState( state, {\n\t\t\t\tshouldShow: false,\n\t\t\t\tshowHelp: false\n\t\t\t} );\n\t\tcase actionTypes.SETTINGS_CHANGE:\n\t\t\treturn action.wasEnabled === action.enabled ?\n\t\t\t\t// If the setting is the same, just hide the dialogs\n\t\t\t\tnextState( state, {\n\t\t\t\t\tshouldShow: false\n\t\t\t\t} ) :\n\t\t\t\t// If the settings have changed...\n\t\t\t\tnextState( state, {\n\t\t\t\t\t// If we enabled, we just hide directly, no help\n\t\t\t\t\t// If we disabled, keep it showing and let the ui show the help.\n\t\t\t\t\tshouldShow: !action.enabled,\n\t\t\t\t\tshowHelp: !action.enabled,\n\n\t\t\t\t\t// Since the footer link is only ever shown to anonymous users (see\n\t\t\t\t\t// the BOOT case below), state.userIsAnon is always truthy here.\n\t\t\t\t\tshouldShowFooterLink: !action.enabled\n\t\t\t\t} );\n\n\t\tcase actionTypes.BOOT:\n\t\t\treturn nextState( state, {\n\t\t\t\tshouldShowFooterLink: action.user.isAnon && !action.isEnabled\n\t\t\t} );\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","import actionTypes from './../actionTypes';\nimport nextState from './nextState';\n\n/**\n * Reducer for actions that may result in an event being logged via statsv.\n *\n * @param {Object} state\n * @param {Object} action\n * @return {Object} state after action\n */\nexport default function statsv( state, action ) {\n\tstate = state || {};\n\n\tswitch ( action.type ) {\n\t\tcase actionTypes.FETCH_START:\n\t\t\treturn nextState( state, {\n\t\t\t\tfetchStartedAt: action.timestamp\n\t\t\t} );\n\n\t\tcase actionTypes.FETCH_END:\n\t\t\treturn nextState( state, {\n\t\t\t\taction: 'timing.PagePreviewsApiResponse',\n\t\t\t\tdata: action.timestamp - state.fetchStartedAt\n\t\t\t} );\n\n\t\tcase actionTypes.FETCH_FAILED:\n\t\t\treturn nextState( state, {\n\t\t\t\taction: 'counter.PagePreviewsApiFailure',\n\t\t\t\tdata: 1\n\t\t\t} );\n\n\t\tcase actionTypes.LINK_DWELL:\n\t\t\treturn nextState( state, {\n\t\t\t\tlinkDwellStartedAt: action.timestamp\n\t\t\t} );\n\n\t\tcase actionTypes.PREVIEW_SHOW:\n\t\t\treturn nextState( state, {\n\t\t\t\taction: 'timing.PagePreviewsPreviewShow',\n\t\t\t\tdata: action.timestamp - state.linkDwellStartedAt\n\t\t\t} );\n\n\t\tcase actionTypes.STATSV_LOGGED:\n\t\t\treturn nextState( state, {\n\t\t\t\taction: null,\n\t\t\t\tdata: null\n\t\t\t} );\n\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n","/**\n * @module title\n */\n\nconst mw = mediaWiki;\n\n/**\n * Fast, native check if we are parsing a self-link, with the only difference beeing the hash.\n *\n * @param {HTMLAnchorElement} el\n * @returns {boolean}\n */\nfunction isOwnPageAnchorLink( el ) {\n\treturn el.hash &&\n\t\t// Note: The protocol is ignored for the sake of simplicity.\n\t\t// Can't compare username and password because they aren't readable from `location`.\n\t\tel.host === location.host &&\n\t\tel.pathname === location.pathname &&\n\t\tel.search === location.search;\n}\n\n/**\n * Gets the title of a local page from an href given some configuration.\n *\n * @param {string} href\n * @param {mw.Map} config\n * @return {string|undefined}\n */\nexport function getTitle( href, config ) {\n\t// Skip every URI that mw.Uri cannot parse\n\tlet linkHref;\n\ttry {\n\t\tlinkHref = new mw.Uri( href );\n\t} catch ( e ) {\n\t\treturn undefined;\n\t}\n\n\t// External links\n\tif ( linkHref.host !== location.hostname ) {\n\t\treturn undefined;\n\t}\n\n\tconst queryLength = Object.keys( linkHref.query ).length;\n\tlet title;\n\n\t// No query params (pretty URL)\n\tif ( !queryLength ) {\n\t\tconst pattern = mw.RegExp.escape( config.get( 'wgArticlePath' ) ).replace( '\\\\$1', '([^?#]+)' ),\n\t\t\tmatches = new RegExp( pattern ).exec( linkHref.path );\n\n\t\t// We can't be sure decodeURIComponent() is able to parse every possible match\n\t\ttry {\n\t\t\ttitle = matches && decodeURIComponent( matches[ 1 ] );\n\t\t} catch ( e ) {\n\t\t\t// Will return undefined below\n\t\t}\n\t} else if ( queryLength === 1 && linkHref.query.hasOwnProperty( 'title' ) ) {\n\t\t// URL is not pretty, but only has a `title` parameter\n\t\ttitle = linkHref.query.title;\n\t}\n\n\treturn title ? `${ title }${ linkHref.fragment ? `#${ linkHref.fragment }` : '' }` : undefined;\n}\n\n/**\n * Given a page title it will return the mediawiki.Title if it is an eligible\n * link for showing page previews, null otherwise\n *\n * @param {string|undefined} title page title to check if it should show preview\n * @param {number[]} contentNamespaces contentNamespaces as specified in\n * wgContentNamespaces\n * @return {mw.Title|null}\n */\nexport function isValid( title, contentNamespaces ) {\n\tif ( !title ) {\n\t\treturn null;\n\t}\n\n\t// Is title in a content namespace?\n\tconst mwTitle = mw.Title.newFromText( title );\n\tif ( mwTitle && contentNamespaces.indexOf( mwTitle.namespace ) >= 0 ) {\n\t\treturn mwTitle;\n\t}\n\n\treturn null;\n}\n\n/**\n * Return an mw.Title from an HTMLAnchorElement if valid for page previews. Convenience\n * method\n *\n * @param {HTMLAnchorElement} el\n * @param {mw.Map} config\n * @return {mw.Title|null}\n */\nexport function fromElement( el, config ) {\n\tif ( isOwnPageAnchorLink( el ) ) {\n\t\t// No need to check the namespace. A self-link can't point to different one.\n\t\treturn mw.Title.newFromText( config.get( 'wgPageName' ) + el.hash );\n\t}\n\n\treturn isValid(\n\t\tgetTitle( el.href, config ),\n\t\tconfig.get( 'wgContentNamespaces' )\n\t);\n}\n","/**\n * @module trackExperimentsInteractions\n */\n\nexport function trackPopupClick( user ) {\n\tif ( user.isAnon() && window.pathfinderPopupsExtVariant ) {\n\t\twindow.pathfinderTracking.trackPopupsExt({\n\t\t\taction: 'click'\n\t\t});\n\t}\n}\n\nexport function trackPopupHover( user ) {\n\tif ( user.isAnon() && window.pathfinderPopupsExtVariant ) {\n\t\twindow.pathfinderTracking.trackPopupsExt({\n\t\t\taction: 'mouseover'\n\t\t});\n\t}\n}\n","module.exports = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"0\\\" height=\\\"0\\\"><defs><clipPath id=\\\"mwe-popups-mask\\\"><path d=\\\"M0 8h10l8-8 8 8h974v992H0z\\\"></path></clipPath><clipPath id=\\\"mwe-popups-mask-flip\\\"><path d=\\\"M0 8h294l8-8 8 8h690v992H0z\\\"></path></clipPath><clipPath id=\\\"mwe-popups-landscape-mask\\\"><path d=\\\"M0 8h174l8-8 8 8h810v992H0z\\\"></path></clipPath><clipPath id=\\\"mwe-popups-landscape-mask-flip\\\"><path d=\\\"M0 0h1000v242H190l-8 8-8-8H0z\\\"></path></clipPath></defs></svg>\"","/**\n * @module renderer\n */\n\nimport wait from '../wait';\nimport pointerMaskSVG from './pointer-mask.svg';\nimport { SIZES, createThumbnail } from './thumbnail';\nimport { previewTypes } from '../preview/model';\nimport { renderPreview } from './templates/preview/preview';\nimport { renderReferencePreview } from './templates/referencePreview/referencePreview';\nimport { renderPagePreview } from './templates/pagePreview/pagePreview';\nimport { renderPagePreviewWithButton } from './templates/pagePreviewWithButton/pagePreviewWithButton';\nimport { renderPagePreviewWithTitle } from './templates/pagePreviewWithTitle/pagePreviewWithTitle';\nimport { renderPagePreviewWithImage } from './templates/pagePreviewWithImage/pagePreviewWithImage';\nimport * as trackExperimentsInteractions from \"../trackExperimentsInteractions\";\n\nconst mw = mediaWiki,\n\t$ = jQuery,\n\t$window = $( window ),\n\tlandscapePopupWidth = 450,\n\tportraitPopupWidth = 320,\n\tpointerSize = 8, // Height of the pointer.\n\tmaxLinkWidthForCenteredPointer = 28; // Link with roughly < 4 chars.\n\n/**\n * Extracted from `mw.popups.createSVGMasks`. This is just an SVG mask to point\n * or \"point\" at the link that's hovered over. The \"pointer\" appears to be cut\n * out of the image itself:\n *   _______                  link\n *  |       |    _/\\_____     _/\\____ <-- Pointer pointing at link\n *  |  :-]  | + |xxxxxxx   = |  :-]  |\n *  |_______|   |xxxxxxx     |_______|\n *              :\n *  Thumbnail    Pointer     Page preview\n *    image     clip-path   bubble w/ pointer\n *\n * SVG masks are used in place of CSS masks for browser support issues (see\n * https://caniuse.com/#feat=css-masks).\n *\n * @private\n * @param {Object} container DOM object to which pointer masks are appended\n * @return {void}\n */\nexport function createPointerMasks( container ) {\n\t$( '<div>' )\n\t\t.attr( 'id', 'mwe-popups-svg' )\n\t\t.html( pointerMaskSVG )\n\t\t.appendTo( container );\n}\n\n/**\n * Initializes the renderer.\n * @return {void}\n */\nexport function init() {\n\tcreatePointerMasks( document.body );\n}\n\n/**\n * The model of how a view is rendered, which is constructed from a response\n * from the gateway.\n *\n * TODO: Rename `isTall` to `isPortrait`.\n *\n * @typedef {Object} ext.popups.Preview\n * @property {JQuery} el\n * @property {boolean} hasThumbnail\n * @property {Object} thumbnail\n * @property {boolean} isTall Sugar around\n *  `preview.hasThumbnail && thumbnail.isTall`\n */\n\n/**\n * Renders a preview given data from the {@link gateway Gateway}.\n * The preview is rendered and added to the DOM but will remain hidden until\n * the `show` method is called.\n *\n * Previews are rendered at:\n *\n * # The position of the mouse when the user dwells on the link with their\n *   mouse.\n * # The centermost point of the link when the user dwells on the link with\n *   their keyboard or other assistive device.\n *\n * Since the content of the preview doesn't change but its position might, we\n * distinguish between \"rendering\" - generating HTML from a MediaWiki API\n * response - and \"showing/hiding\" - positioning the layout and changing its\n * orientation, if necessary.\n *\n * @param {ext.popups.PreviewModel} model\n * @return {ext.popups.Preview}\n */\nexport function render( model ) {\n\tconst preview = createPreviewWithType( model );\n\n\treturn {\n\t\t/**\n\t\t * Shows the preview given an event representing the user's interaction\n\t\t * with the active link, e.g. an instance of\n\t\t * [MouseEvent](https://developer.mozilla.org/en/docs/Web/API/MouseEvent).\n\t\t *\n\t\t * See `show` for more detail.\n\t\t *\n\t\t * @param {Event} event\n\t\t * @param {Object} boundActions The\n\t\t *  [bound action creators](http://redux.js.org/docs/api/bindActionCreators.html)\n\t\t *  that were (likely) created in [boot.js](./boot.js).\n\t\t * @param {string} token The unique token representing the link interaction\n\t\t *  that resulted in showing the preview\n\t\t * @return {JQuery.Promise<void>}\n\t\t */\n\t\tshow( event, boundActions, token ) {\n\t\t\treturn show(\n\t\t\t\tpreview, event, $( event.target ), boundActions, token,\n\t\t\t\tdocument.body, document.documentElement.getAttribute( 'dir' )\n\t\t\t);\n\t\t},\n\n\t\t/**\n\t\t * Hides the preview.\n\t\t *\n\t\t * See `hide` for more detail.\n\t\t *\n\t\t * @return {JQuery.Promise<void>}\n\t\t */\n\t\thide() {\n\t\t\treturn hide( preview );\n\t\t}\n\t};\n}\n/**\n * Creates an instance of a Preview based on\n * the type property of the PreviewModel\n *\n * @param {ext.popups.PreviewModel} model\n * @return {ext.popups.Preview}\n */\nexport function createPreviewWithType( model ) {\n\tswitch ( model.type ) {\n\t\tcase previewTypes.TYPE_PAGE:\n\t\t\treturn createPagePreview( model );\n\t\tcase previewTypes.TYPE_DISAMBIGUATION:\n\t\t\treturn createDisambiguationPreview( model );\n\t\tcase previewTypes.TYPE_REFERENCE:\n\t\t\treturn createReferencePreview( model );\n\t\tdefault:\n\t\t\treturn createEmptyPreview( model );\n\t}\n}\n\n/**\n * Creates an instance of the DTO backing a preview.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createPagePreview( model ) {\n\tconst thumbnail = createThumbnail( model.thumbnail ),\n\t\thasThumbnail = thumbnail !== null;\n\n\treturn {\n\t\tel: renderPagePreview( model, thumbnail ),\n\t\thasThumbnail,\n\t\tthumbnail,\n\t\tisTall: hasThumbnail && thumbnail.isTall\n\t};\n}\n\n/**\n * Creates an instance of the DTO backing a preview with buttons.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createPagePreviewWithButton( model ) {\n\tconst thumbnail = createThumbnail( model.thumbnail ),\n\t\thasThumbnail = thumbnail !== null;\n\n\treturn {\n\t\tel: renderPagePreviewWithButton( model, thumbnail ),\n\t\thasThumbnail,\n\t\tthumbnail,\n\t\tisTall: hasThumbnail && thumbnail.isTall\n\t};\n}\n\n/**\n * Creates an instance of the DTO backing a preview with title.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createPagePreviewWithTitle( model ) {\n\treturn {\n\t\tel: renderPagePreviewWithTitle( model, null ),\n\t\thasThumbnail: false,\n\t\tthumbnail: false,\n\t\tisTall: false\n\t};\n}\n\n/**\n * Creates an instance of the DTO backing a preview with image.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createPagePreviewWithImage( model ) {\n\tconst thumbnail = createThumbnail( model.thumbnail ),\n\t\thasThumbnail = thumbnail !== null;\n\n\treturn {\n\t\tel: renderPagePreviewWithImage( model, thumbnail ),\n\t\thasThumbnail,\n\t\tthumbnail,\n\t\tisTall: false\n\t};\n}\n\n/**\n * Creates an instance of the DTO backing a preview. In this case the DTO\n * represents a generic preview, which covers the following scenarios:\n *\n * * The page doesn't exist, i.e. the user hovered over a redlink or a\n *   redirect to a page that doesn't exist.\n * * The page doesn't have a viable extract.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createEmptyPreview( model ) {\n\tconst showTitle = false,\n\t\textractMsg = mw.msg( 'popups-preview-no-preview' ),\n\t\tlinkMsg = mw.msg( 'popups-preview-footer-read' );\n\n\treturn {\n\t\tel: renderPreview( model, showTitle, extractMsg, linkMsg ),\n\t\thasThumbnail: false,\n\t\tisTall: false\n\t};\n}\n\n/**\n * Creates an instance of the disambiguation preview.\n *\n * @param {ext.popups.PagePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createDisambiguationPreview( model ) {\n\tconst showTitle = true,\n\t\textractMsg = mw.msg( 'popups-preview-disambiguation' ),\n\t\tlinkMsg = mw.msg( 'popups-preview-disambiguation-link' );\n\n\treturn {\n\t\tel: renderPreview( model, showTitle, extractMsg, linkMsg ),\n\t\thasThumbnail: false,\n\t\tisTall: false\n\t};\n}\n\n/**\n * @param {ext.popups.ReferencePreviewModel} model\n * @return {ext.popups.Preview}\n */\nfunction createReferencePreview( model ) {\n\treturn {\n\t\tel: renderReferencePreview( model ),\n\t\thasThumbnail: false,\n\t\tisTall: false\n\t};\n}\n\n/**\n * Shows the preview.\n *\n * Extracted from `mw.popups.render.openPopup`.\n *\n * TODO: From the perspective of the client, there's no need to distinguish\n * between rendering and showing a preview. Merge #render and Preview#show.\n *\n * @param {ext.popups.Preview} preview\n * @param {Event} event\n * @param {JQuery} $link event target\n * @param {ext.popups.PreviewBehavior} behavior\n * @param {string} token\n * @param {Object} container DOM object to which pointer masks are appended\n * @param {string} dir 'ltr' if left-to-right, 'rtl' if right-to-left.\n * @return {JQuery.Promise<void>} A promise that resolves when the promise has\n *                                faded in.\n */\nexport function show(\n\tpreview, event, $link, behavior, token, container, dir\n) {\n\tconst layout = createLayout(\n\t\tpreview.isTall,\n\t\t{\n\t\t\tpageX: event.pageX,\n\t\t\tpageY: event.pageY,\n\t\t\tclientY: event.clientY\n\t\t},\n\t\t{\n\t\t\tclientRects: $link.get( 0 ).getClientRects(),\n\t\t\toffset: $link.offset(),\n\t\t\twidth: $link.width(),\n\t\t\theight: $link.height()\n\t\t},\n\t\t{\n\t\t\tscrollTop: $window.scrollTop(),\n\t\t\twidth: $window.width(),\n\t\t\theight: $window.height()\n\t\t},\n\t\tpointerSize,\n\t\tdir\n\t);\n\n\tpreview.el.appendTo( container );\n\n\tlayoutPreview(\n\t\tpreview, layout, getClasses( preview, layout ),\n\t\tSIZES.landscapeImage.h, pointerSize\n\t);\n\n\tpreview.el.show();\n\n\t// Trigger fading effect for reference previews after the popup has been rendered\n\tif ( preview.el.hasClass( 'mwe-popups-type-reference' ) ) {\n\t\tpreview.el.find( '.mw-parser-output' ).first().trigger( 'scroll' );\n\t}\n\n\treturn wait( 200 )\n\t\t.then( () => {\n\t\t\tbindBehavior( preview, behavior );\n\t\t\tbehavior.previewShow( token );\n\t\t} );\n}\n\n/**\n * Binds the behavior to the interactive elements of the preview.\n *\n * @param {ext.popups.Preview} preview\n * @param {ext.popups.PreviewBehavior} behavior\n * @return {void}\n */\nexport function bindBehavior( preview, behavior ) {\n\tpreview.el.on( 'mouseenter', behavior.previewDwell )\n\t\t.on( 'mouseleave', behavior.previewAbandon );\n\n\tpreview.el.click( behavior.click );\n\n\tpreview.el.find( '.mwe-popups-settings-icon' )\n\t\t.attr( 'href', behavior.settingsUrl )\n\t\t.click( ( event ) => {\n\t\t\tevent.stopPropagation();\n\n\t\t\tbehavior.showSettings( event );\n\t\t} );\n\n\t// Popups experiment:\n\t// find the button and track click action, hover on popup\n\tpreview.el.find( '.mwe-popups-buttons-section .mwe-popups-discreet .mwe-popups-extract').click( ( event ) => {\n\t\tevent.stopPropagation();\n\t\ttrackExperimentsInteractions.trackPopupClick( event );\n\t});\n\n\tlet timeoutId = null;\n\tpreview.el.find( '.mwe-popups' ).on(\n\t\t'mouseover', function( event ) {\n\t\t\ttimeoutId = setTimeout(function(){\n\t\t\t\ttrackExperimentsInteractions.trackPopupHover( event );\n\t\t\t}, 2000);\n\t\t},\n\t\tfalse\n\t);\n\tpreview.el.find( '.mwe-popups' ).on(\n\t\t'mouseout', function() {\n\t\t\tclearTimeout( timeoutId )\n\t\t},\n\t\tfalse\n\t);\n}\n\n/**\n * Extracted from `mw.popups.render.closePopup`.\n *\n * @param {ext.popups.Preview} preview\n * @return {JQuery.Promise<void>} A promise that resolves when the preview has\n *                                faded out.\n */\nexport function hide( preview ) {\n\t// FIXME: This method clearly needs access to the layout of the preview.\n\tconst fadeInClass = ( preview.el.hasClass( 'mwe-popups-fade-in-up' ) ) ?\n\t\t'mwe-popups-fade-in-up' :\n\t\t'mwe-popups-fade-in-down';\n\n\tconst fadeOutClass = ( fadeInClass === 'mwe-popups-fade-in-up' ) ?\n\t\t'mwe-popups-fade-out-down' :\n\t\t'mwe-popups-fade-out-up';\n\n\tpreview.el\n\t\t.removeClass( fadeInClass )\n\t\t.addClass( fadeOutClass );\n\n\treturn wait( 150 ).then( () => {\n\t\tpreview.el.remove();\n\t} );\n}\n\n/**\n * Represents the layout of a preview, which consists of a position (`offset`)\n * and whether or not the preview should be flipped horizontally or\n * vertically (`flippedX` and `flippedY` respectively).\n *\n * @typedef {Object} ext.popups.PreviewLayout\n * @property {Object} offset\n * @property {number} offset.top\n * @property {number} offset.left\n * @property {boolean} flippedX\n * @property {boolean} flippedY\n * @property {string} dir 'ltr' if left-to-right, 'rtl' if right-to-left.\n */\n\n/**\n * @param {boolean} isPreviewTall\n * @param {Object} eventData Data related to the event that triggered showing\n *  a popup\n * @param {number} eventData.pageX\n * @param {number} eventData.pageY\n * @param {number} eventData.clientY\n * @param {Object} linkData Data related to the link thats used for showing\n *  a popup\n * @param {ClientRectList} linkData.clientRects list of rectangles defined by\n *  four edges\n * @param {Object} linkData.offset\n * @param {number} linkData.width\n * @param {number} linkData.height\n * @param {Object} windowData Data related to the window\n * @param {number} windowData.scrollTop\n * @param {number} windowData.width\n * @param {number} windowData.height\n * @param {number} pointerSize Space reserved for the pointer\n * @param {string} dir 'ltr' if left-to-right, 'rtl' if right-to-left.\n * @return {ext.popups.PreviewLayout}\n */\nexport function createLayout(\n\tisPreviewTall, eventData, linkData, windowData, pointerSize, dir\n) {\n\tlet flippedX = false,\n\t\tflippedY = false,\n\t\toffsetTop = eventData.pageY ?\n\t\t\t// If it was a mouse event, position according to mouse\n\t\t\t// Since client rectangles are relative to the viewport,\n\t\t\t// take scroll position into account.\n\t\t\tgetClosestYPosition(\n\t\t\t\teventData.pageY - windowData.scrollTop,\n\t\t\t\tlinkData.clientRects,\n\t\t\t\tfalse\n\t\t\t) + windowData.scrollTop + pointerSize :\n\t\t\t// Position according to link position or size\n\t\t\tlinkData.offset.top + linkData.height + pointerSize,\n\t\toffsetLeft;\n\tconst clientTop = eventData.clientY ? eventData.clientY : offsetTop;\n\n\tif ( eventData.pageX ) {\n\t\tif ( linkData.width > maxLinkWidthForCenteredPointer ) {\n\t\t\t// For wider links, position the popup's pointer at the\n\t\t\t// mouse pointer's location. (x-axis)\n\t\t\toffsetLeft = eventData.pageX;\n\t\t} else {\n\t\t\t// For smaller links, position the popup's pointer at\n\t\t\t// the link's center. (x-axis)\n\t\t\toffsetLeft = linkData.offset.left + linkData.width / 2;\n\t\t}\n\t} else {\n\t\toffsetLeft = linkData.offset.left;\n\t}\n\n\t// X Flip\n\tif ( offsetLeft > ( windowData.width / 2 ) ) {\n\t\toffsetLeft += ( !eventData.pageX ) ? linkData.width : 0;\n\t\toffsetLeft -= !isPreviewTall ?\n\t\t\tportraitPopupWidth :\n\t\t\tlandscapePopupWidth;\n\t\tflippedX = true;\n\t}\n\n\tif ( eventData.pageX ) {\n\t\toffsetLeft += ( flippedX ) ? 18 : -18;\n\t}\n\n\t// Y Flip\n\tif ( clientTop > ( windowData.height / 2 ) ) {\n\t\tflippedY = true;\n\n\t\t// Mirror the positioning of the preview when there's no \"Y flip\": rest\n\t\t// the pointer on the edge of the link's bounding rectangle. In this case\n\t\t// the edge is the top-most.\n\t\toffsetTop = linkData.offset.top;\n\n\t\t// Change the Y position to the top of the link\n\t\tif ( eventData.pageY ) {\n\t\t\t// Since client rectangles are relative to the viewport,\n\t\t\t// take scroll position into account.\n\t\t\toffsetTop = getClosestYPosition(\n\t\t\t\teventData.pageY - windowData.scrollTop,\n\t\t\t\tlinkData.clientRects,\n\t\t\t\ttrue\n\t\t\t) + windowData.scrollTop;\n\t\t}\n\n\t\toffsetTop -= pointerSize;\n\t}\n\n\treturn {\n\t\toffset: {\n\t\t\ttop: offsetTop,\n\t\t\tleft: offsetLeft\n\t\t},\n\t\tflippedX: dir === 'rtl' ? !flippedX : flippedX,\n\t\tflippedY,\n\t\tdir\n\t};\n}\n\n/**\n * Generates a list of declarative CSS classes that represent the layout of\n * the preview.\n *\n * @param {ext.popups.Preview} preview\n * @param {ext.popups.PreviewLayout} layout\n * @return {string[]}\n */\nexport function getClasses( preview, layout ) {\n\tconst classes = [];\n\n\tif ( layout.flippedY ) {\n\t\tclasses.push( 'mwe-popups-fade-in-down' );\n\t} else {\n\t\tclasses.push( 'mwe-popups-fade-in-up' );\n\t}\n\n\tif ( layout.flippedY && layout.flippedX ) {\n\t\tclasses.push( 'flipped-x-y' );\n\t} else if ( layout.flippedY ) {\n\t\tclasses.push( 'flipped-y' );\n\t} else if ( layout.flippedX ) {\n\t\tclasses.push( 'flipped-x' );\n\t}\n\n\tif ( ( !preview.hasThumbnail || preview.isTall && !layout.flippedX ) &&\n\t\t!layout.flippedY ) {\n\t\tclasses.push( 'mwe-popups-no-image-pointer' );\n\t}\n\n\tif ( preview.hasThumbnail && !preview.isTall && !layout.flippedY ) {\n\t\tclasses.push( 'mwe-popups-image-pointer' );\n\t}\n\n\tif ( preview.isTall ) {\n\t\tclasses.push( 'mwe-popups-is-tall' );\n\t} else {\n\t\tclasses.push( 'mwe-popups-is-not-tall' );\n\t}\n\n\treturn classes;\n}\n\n/**\n * Lays out the preview given the layout.\n *\n * If the thumbnail is landscape and isn't the full height of the thumbnail\n * container, then pull the extract up to keep whitespace consistent across\n * previews.\n *\n * @param {ext.popups.Preview} preview\n * @param {ext.popups.PreviewLayout} layout\n * @param {string[]} classes class names used for layout out the preview\n * @param {number} predefinedLandscapeImageHeight landscape image height\n * @param {number} pointerSize\n * @return {void}\n */\nexport function layoutPreview(\n\tpreview, layout, classes, predefinedLandscapeImageHeight, pointerSize\n) {\n\tconst popup = preview.el,\n\t\tisTall = preview.isTall,\n\t\thasThumbnail = preview.hasThumbnail,\n\t\tthumbnail = preview.thumbnail,\n\t\tflippedY = layout.flippedY;\n\tlet offsetTop = layout.offset.top;\n\n\tif (\n\t\t!flippedY && !isTall && hasThumbnail &&\n\t\t\tthumbnail.height < predefinedLandscapeImageHeight\n\t) {\n\t\tpopup.find( '.mwe-popups-extract' ).css(\n\t\t\t'margin-top',\n\t\t\tthumbnail.height - pointerSize\n\t\t);\n\t}\n\n\tpopup.addClass( classes.join( ' ' ) );\n\n\tif ( flippedY ) {\n\t\toffsetTop -= popup.outerHeight();\n\t}\n\n\tpopup.css( {\n\t\ttop: offsetTop,\n\t\tleft: `${ layout.offset.left }px`\n\t} );\n\n\tif ( hasThumbnail ) {\n\t\tsetThumbnailClipPath( preview, layout );\n\t}\n}\n\n/**\n * Sets the thumbnail SVG clip-path.\n *\n * If the preview should be oriented differently, then the pointer is updated,\n * e.g. if the preview should be flipped vertically, then the pointer is\n * removed.\n *\n * Note: SVG clip-paths are supported everywhere but clip-paths as CSS\n * properties are not (https://caniuse.com/#feat=css-clip-path). For this\n * reason, RTL flipping is handled in JavaScript instead of CSS.\n *\n * @param {ext.popups.Preview} preview\n * @param {ext.popups.PreviewLayout} layout\n * @return {void}\n */\nexport function setThumbnailClipPath(\n\t{ el, isTall, thumbnail }, { flippedY, flippedX, dir }\n) {\n\tconst maskID = getThumbnailClipPathID( isTall, flippedY, flippedX );\n\tif ( maskID ) {\n\t\t// CSS matrix transform entries:\n\t\t//  sx c tx \n\t\t//  sy d ty \n\t\tconst matrix = {\n\t\t\tscaleX: 1,\n\t\t\t// moving the mask horizontally if the image is less than the maximum width\n\t\t\ttranslateX: isTall ? Math.min( thumbnail.width - SIZES.portraitImage.w, 0 ) : 0\n\t\t};\n\n\t\tif ( dir === 'rtl' ) {\n\t\t\t// flipping the mask horizontally\n\t\t\tmatrix.scaleX = -1;\n\t\t\t// moving the mask horizontally to the max width of the thumbnail\n\t\t\tmatrix.translateX = isTall ? SIZES.portraitImage.w : SIZES.landscapeImage.w;\n\t\t}\n\n\t\t// Transform the clip-path not the image it is applied to.\n\t\tconst mask = document.getElementById( maskID );\n\t\tmask.setAttribute(\n\t\t\t'transform',\n\t\t\t`matrix(${matrix.scaleX} 0 0 1 ${matrix.translateX} 0)`\n\t\t);\n\n\t\tel.find( 'image' )[ 0 ]\n\t\t\t.setAttribute( 'clip-path', `url(#${maskID})` );\n\t}\n}\n\n/**\n * Gets the thumbnail SVG clip-path element ID as specified in pointer-mask.svg.\n *\n * @param {boolean} isTall Sugar around\n *  `preview.hasThumbnail && thumbnail.isTall`\n * @param {boolean} flippedY\n * @param {boolean} flippedX\n * @return {string|undefined}\n */\nexport function getThumbnailClipPathID( isTall, flippedY, flippedX ) {\n\t// Clip-paths are only needed when the pointer is in a corner that is covered by the thumbnail.\n\t// This is only the case in 4 of 8 situations:\n\tif ( !isTall && !flippedY ) {\n\t\t// 1. Landscape thumbnails cover the upper half of the popup. This is only the case when the\n\t\t// pointer is not flipped to the bottom.\n\t\treturn flippedX ? 'mwe-popups-mask-flip' : 'mwe-popups-mask';\n\t} else if ( isTall && flippedX ) {\n\t\t// 2. Tall thumbnails cover the right half of the popup. This is only the case when the\n\t\t// pointer is flipped to the right.\n\t\treturn flippedY ? 'mwe-popups-landscape-mask-flip' : 'mwe-popups-landscape-mask';\n\t}\n\n\t// The 4 combinations not covered above don't need a clip-path.\n\treturn undefined;\n}\n\n/**\n * Given the rectangular box(es) find the 'y' boundary of the closest\n * rectangle to the point 'y'. The point 'y' is the location of the mouse\n * on the 'y' axis and the rectangular box(es) are the borders of the\n * element over which the mouse is located. There will be more than one\n * rectangle in case the element spans multiple lines.\n *\n * In the majority of cases the mouse pointer will be inside a rectangle.\n * However, some browsers (i.e. Chrome) trigger a hover action even when\n * the mouse pointer is just outside a bounding rectangle. That's why\n * we need to look at all rectangles and not just the rectangle that\n * encloses the point.\n *\n * @private\n * @param {number} y the point for which the closest location is being\n *  looked for\n * @param {ClientRectList} rects list of rectangles defined by four edges\n * @param {boolean} [isTop] should the resulting rectangle's top 'y'\n *  boundary be returned. By default the bottom 'y' value is returned.\n * @return {number}\n */\nexport function getClosestYPosition( y, rects, isTop ) {\n\tlet minY = null, result;\n\n\tArray.prototype.slice.call( rects ).forEach( ( rect ) => {\n\t\tconst deltaY = Math.abs( y - rect.top + y - rect.bottom );\n\n\t\tif ( minY === null || minY > deltaY ) {\n\t\t\tminY = deltaY;\n\t\t\t// Make sure the resulting point is at or outside the rectangle\n\t\t\t// boundaries.\n\t\t\tresult = ( isTop ) ? Math.floor( rect.top ) : Math.ceil( rect.bottom );\n\t\t}\n\t} );\n\n\treturn result;\n}\n","/**\n * @module settingsDialog\n */\n\nimport { renderSettingsDialog } from './templates/settingsDialog/settingsDialog';\n\nconst mw = mediaWiki;\n\n/**\n * Create the settings dialog shown to anonymous users.\n *\n * @param {boolean} navPopupsEnabled\n * @return {JQuery} settings dialog\n */\nexport function createSettingsDialog( navPopupsEnabled ) {\n\tconst choices = [\n\t\t{\n\t\t\tid: 'simple',\n\t\t\tname: mw.msg( 'popups-settings-option-simple' ),\n\t\t\tdescription: mw.msg( 'popups-settings-option-simple-description' ),\n\t\t\tisChecked: true\n\t\t},\n\t\t{\n\t\t\tid: 'advanced',\n\t\t\tname: mw.msg( 'popups-settings-option-advanced' ),\n\t\t\tdescription: mw.msg( 'popups-settings-option-advanced-description' )\n\t\t},\n\t\t{\n\t\t\tid: 'off',\n\t\t\tname: mw.msg( 'popups-settings-option-off' )\n\t\t}\n\t];\n\n\tif ( !navPopupsEnabled ) {\n\t\t// remove the advanced option\n\t\tchoices.splice( 1, 1 );\n\t}\n\n\treturn renderSettingsDialog( {\n\t\theading: mw.msg( 'popups-settings-title' ),\n\t\tcloseLabel: mw.msg( 'popups-settings-cancel' ),\n\t\tsaveLabel: mw.msg( 'popups-settings-save' ),\n\t\thelpText: mw.msg( 'popups-settings-help' ),\n\t\tokLabel: mw.msg( 'popups-settings-help-ok' ),\n\t\tchoices\n\t} );\n}\n","/**\n * @module settingsDialogRenderer\n */\n\nimport { createSettingsDialog } from './settingsDialog';\n\nconst $ = jQuery;\n\n/**\n * Creates a render function that will create the settings dialog and return\n * a set of methods to operate on it\n * @return {Function} render function\n */\nexport default function createSettingsDialogRenderer() {\n\t/**\n\t * Cached settings dialog\n\t *\n\t * @type {JQuery}\n\t */\n\tlet $dialog,\n\t\t/**\n\t\t * Cached settings overlay\n\t\t *\n\t\t * @type {JQuery}\n\t\t */\n\t\t$overlay;\n\n\t/**\n\t * Renders the relevant form and labels in the settings dialog\n\t * @param {Object} boundActions\n\t * @return {Object} object with methods to affect the rendered UI\n\t */\n\treturn ( boundActions ) => {\n\t\tif ( !$dialog ) {\n\t\t\t$dialog = createSettingsDialog( isNavPopupsEnabled() );\n\t\t\t$overlay = $( '<div>' ).addClass( 'mwe-popups-overlay' );\n\n\t\t\t// Setup event bindings\n\n\t\t\t$dialog.find( '.save' ).on( 'click', () => {\n\t\t\t\t// Find the selected value (simple|advanced|off)\n\t\t\t\tconst selected = getSelectedSetting( $dialog ),\n\t\t\t\t\t// Only simple means enabled, advanced is disabled in favor of\n\t\t\t\t\t// NavPops and off means disabled.\n\t\t\t\t\tenabled = selected === 'simple';\n\n\t\t\t\tboundActions.saveSettings( enabled );\n\t\t\t} );\n\t\t\t$dialog.find( '.close, .okay' ).on( 'click', boundActions.hideSettings );\n\t\t}\n\n\t\treturn {\n\t\t\t/**\n\t\t\t * Append the dialog and overlay to a DOM element\n\t\t\t * @param {HTMLElement} el\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\tappendTo( el ) {\n\t\t\t\t$overlay.appendTo( el );\n\t\t\t\t$dialog.appendTo( $overlay );\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Show the settings element and position it correctly\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\tshow() {\n\t\t\t\t$overlay.show();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Hide the settings dialog.\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\thide() {\n\t\t\t\t$overlay.hide();\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Toggle the help dialog on or off\n\t\t\t * @param {boolean} visible if you want to show or hide the help dialog\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\ttoggleHelp( visible ) {\n\t\t\t\ttoggleHelp( $dialog, visible );\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * Update the form depending on the enabled flag\n\t\t\t *\n\t\t\t * If false and no navpops, then checks 'off'\n\t\t\t * If true, then checks 'on'\n\t\t\t * If false, and there are navpops, then checks 'advanced'\n\t\t\t *\n\t\t\t * @param {boolean} enabled if page previews are enabled\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\tsetEnabled( enabled ) {\n\t\t\t\tlet name = 'off';\n\t\t\t\tif ( enabled ) {\n\t\t\t\t\tname = 'simple';\n\t\t\t\t} else if ( isNavPopupsEnabled() ) {\n\t\t\t\t\tname = 'advanced';\n\t\t\t\t}\n\n\t\t\t\t// Check the appropriate radio button\n\t\t\t\t$dialog.find( `#mwe-popups-settings-${ name }` )\n\t\t\t\t\t.prop( 'checked', true );\n\t\t\t}\n\t\t};\n\t};\n}\n\n/**\n * Get the selected value on the radio button\n *\n * @param {JQuery.Object} $el the element to extract the setting from\n * @return {string} Which should be (simple|advanced|off)\n */\nfunction getSelectedSetting( $el ) {\n\treturn $el.find(\n\t\t'input[name=mwe-popups-setting]:checked, #mwe-popups-settings'\n\t).val();\n}\n\n/**\n * Toggles the visibility between a form and the help\n * @param {JQuery.Object} $el element that contains form and help\n * @param {boolean} visible if the help should be visible, or the form\n * @return {void}\n */\nfunction toggleHelp( $el, visible ) {\n\t// eslint-disable-next-line no-jquery/no-global-selector\n\tconst $dialog = $( '#mwe-popups-settings' ),\n\t\tformSelectors = 'main, .save, .close',\n\t\thelpSelectors = '.mwe-popups-settings-help, .okay';\n\n\tif ( visible ) {\n\t\t$dialog.find( formSelectors ).hide();\n\t\t$dialog.find( helpSelectors ).show();\n\t} else {\n\t\t$dialog.find( formSelectors ).show();\n\t\t$dialog.find( helpSelectors ).hide();\n\t}\n}\n\n/**\n * Checks if the NavigationPopups gadget is enabled by looking at the global\n * variables\n * @return {boolean} if navpops was found to be enabled\n */\nfunction isNavPopupsEnabled() {\n\t/* global pg */\n\treturn typeof pg !== 'undefined' && pg.fn.disablePopups !== undefined;\n}\n","/**\n * @module pagePreview\n */\n\nimport { renderPopup } from '../popup/popup';\nimport { escapeHTML } from '../templateUtil';\n\nconst defaultExtractWidth = 215;\n\n/**\n * @param {ext.popups.PagePreviewModel} model\n * @param {ext.popups.Thumbnail|null} thumbnail\n * @return {JQuery}\n */\nexport function renderPagePreview(\n\tmodel, thumbnail\n) {\n\tconst url = escapeHTML( model.url ),\n\t\tlanguageCode = escapeHTML( model.languageCode ),\n\t\tlanguageDirection = escapeHTML( model.languageDirection );\n\n\tconst $el = renderPopup( model.type,\n\t\t`\n\t\t\t${ thumbnail ? `<a href='${ url }' class='mwe-popups-discreet'></a>` : '' }\n\t\t\t<a dir='${ languageDirection }' lang='${ languageCode }' class='mwe-popups-extract' href='${ url }'></a>\n\t\t\t<footer>\n\t\t\t\t<a class='mwe-popups-settings-icon'>\n\t\t\t\t\t<span class=\"mw-ui-icon mw-ui-icon-element mw-ui-icon-popups-settings\"></span>\n\t\t\t\t</a>\n\t\t\t</footer>\n\t\t`\n\t);\n\n\tif ( thumbnail ) {\n\t\t$el.find( '.mwe-popups-discreet' ).append( thumbnail.el );\n\t}\n\n\tif ( model.extract ) {\n\t\tconst extractWidth = getExtractWidth( thumbnail );\n\t\t$el.find( '.mwe-popups-extract' )\n\t\t\t.css( 'width', extractWidth )\n\t\t\t.append( model.extract );\n\t\t$el.find( 'footer' ).css( 'width', extractWidth );\n\t}\n\n\treturn $el;\n}\n\nexport { defaultExtractWidth }; // for testing\n\n/**\n * Calculates width of extract based on the associated thumbnail\n *\n * @param {ext.popups.Thumbnail|null} thumbnail model\n * @return {string} representing the css width attribute to be\n *   used for the extract\n */\nexport function getExtractWidth( thumbnail ) {\n\treturn thumbnail && thumbnail.isNarrow ? `${ defaultExtractWidth + thumbnail.offset }px` : '';\n}\n","import {renderPagePreview} from '../pagePreview/pagePreview';\nimport {escapeHTML} from '../templateUtil';\n\nconst mw = mediaWiki;\n\nexport function renderPagePreviewWithButton(model, thumbnail) {\n\tconst url = escapeHTML(model.url);\n\tconst $el = renderPagePreview(model, thumbnail)\n\n\tconst buttonSection = $('<div class=\"mwe-popups-buttons-section\"></div>')\n\tbuttonSection.append(`<a href=\"${url}\" target=\"_blank\" class=\"wds-button\">${mw.msg('popups-fandom-action-button')}</a>`);\n\n\t$el.find('.mwe-popups-container')\n\t\t.addClass('mwe-popups-fandom')\n\t\t.prepend(`<div class=\"mwe-popups-header\">${mw.msg('popups-fandom-header-text')}</div>`)\n\t\t.append(buttonSection);\n\treturn $el;\n}\n","import {renderPagePreviewWithButton} from '../pagePreviewWithButton/pagePreviewWithButton';\nimport {escapeHTML} from '../templateUtil';\nimport {SIZES} from '../../thumbnail';\n\nexport function renderPagePreviewWithImage(model, thumbnail) {\n\tconst $el = renderPagePreviewWithButton(model, thumbnail)\n\n\t// If there is no thumbnail we cannot do anything. For now display normal element with buttons\n\tif (!thumbnail) {\n\t\treturn $el;\n\t}\n\n\t// Remove unnecessary elements\n\t$el.find('.mwe-popups-header').remove();\n\t$el.find('.mwe-popups-extract').remove();\n\n\t// Adjust width and height of overflow to match actual image size\n\tconst maxHeight = thumbnail.isTall ? SIZES.portraitImage.h : SIZES.landscapeImage.h;\n\tconst thumbHeight = maxHeight < thumbnail.height ? maxHeight : thumbnail.height;\n\tconst $overflow = $('<span class=\"mwe-popups-overflow\"></span>')\n\t\t.css({\n\t\t\twidth: '100%',\n\t\t\theight: thumbHeight\n\t\t});\n\n\tconst title = escapeHTML(model.title);\n\tconst $title = $(`<h4 class=\"mwe-popups-overflow-title\">${title}</h4>`)\n\t\t.css({\n\t\t\ttop: thumbHeight * 0.2 + \"px\"\n\t\t});\n\t$overflow.append($title);\n\n\tconst $imageContainer = $el.find('.mwe-popups-discreet')\n\t\t.prepend($overflow)\n\n\n\t// We display all images in landscape view, therefore we need to put image in the middle\n\t$imageContainer.find('svg').css({\n\t\tdisplay: 'block',\n\t\tmargin: '0 auto',\n\t\tposition: 'relative'\n\t});\n\n\treturn $el;\n}\n","import {renderPagePreviewWithButton} from '../pagePreviewWithButton/pagePreviewWithButton';\nimport {escapeHTML} from '../templateUtil';\n\nexport function renderPagePreviewWithTitle(model, thumbnail) {\n\tconst $el = renderPagePreviewWithButton(model, thumbnail)\n\tconst title = escapeHTML(model.title)\n\n\t$el.find('.mwe-popups-header')\n\t\t.html(`<h4>${title}</h4>`);\n\treturn $el;\n}\n","/**\n * @module popup\n */\n\nimport { escapeHTML } from '../templateUtil';\n\n/**\n * @param {ext.popups.previewTypes} type\n * @param {string} html HTML string.\n * @return {JQuery}\n */\nexport function renderPopup( type, html ) {\n\ttype = escapeHTML( type );\n\n\treturn $( $.parseHTML( `\n\t<div class='mwe-popups mwe-popups-type-${ type }' role='tooltip' aria-hidden>\n\t\t<div class='mwe-popups-container'>${ html }</div>\n\t</div>\n\t`.trim() ) );\n}\n","/**\n * @module preview\n */\n\nimport { renderPopup } from '../popup/popup';\nimport { escapeHTML } from '../templateUtil';\n\n/**\n * @param {ext.popups.PagePreviewModel} model\n * @param {boolean} showTitle\n * @param {string} extractMsg\n * @param {string} linkMsg\n * @return {JQuery}\n */\nexport function renderPreview(\n\tmodel, showTitle, extractMsg, linkMsg\n) {\n\tconst title = escapeHTML( model.title ),\n\t\turl = escapeHTML( model.url ),\n\t\ttype = escapeHTML( model.type );\n\textractMsg = escapeHTML( extractMsg );\n\tlinkMsg = escapeHTML( linkMsg );\n\n\treturn renderPopup( model.type,\n\t\t`\n\t\t\t<div class='mw-ui-icon mw-ui-icon-element mw-ui-icon-preview-${ type }'></div>\n\t\t\t${ showTitle ? `<strong class='mwe-popups-title'>${ title }</strong>` : '' }\n\t\t\t<a href='${ url }' class='mwe-popups-extract'>\n\t\t\t\t<span class='mwe-popups-message'>${ extractMsg }</span>\n\t\t\t</a>\n\t\t\t<footer>\n\t\t\t\t<a href='${ url }' class='mwe-popups-read-link'>${ linkMsg }</a>\n\t\t\t</footer>\n\t\t`\n\t);\n}\n","/**\n * @module referencePreview\n */\n\nimport { renderPopup } from '../popup/popup';\nimport { escapeHTML } from '../templateUtil';\n\n// Known citation type strings currently supported with icons and messages.\nconst KNOWN_TYPES = [ 'book', 'journal', 'news', 'web' ],\n\tmw = mediaWiki,\n\t$ = jQuery;\n\n/**\n * @param {ext.popups.ReferencePreviewModel} model\n * @return {JQuery}\n */\nexport function renderReferencePreview(\n\tmodel\n) {\n\tconst type = KNOWN_TYPES.indexOf( model.referenceType ) < 0 ? 'generic' : model.referenceType,\n\t\t// Messages:\n\t\t// popups-refpreview-book\n\t\t// popups-refpreview-journal\n\t\t// popups-refpreview-news\n\t\t// popups-refpreview-reference\n\t\t// popups-refpreview-web\n\t\ttitleMsg = `popups-refpreview-${ type === 'generic' ? 'reference' : type }`,\n\t\ttitle = escapeHTML( mw.msg( titleMsg ) ),\n\t\turl = escapeHTML( model.url ),\n\t\tlinkMsg = escapeHTML( mw.msg( 'popups-refpreview-jump-to-reference' ) );\n\n\tconst $el = renderPopup( model.type,\n\t\t`\n\t\t\t<strong class='mwe-popups-title'>\n\t\t\t\t<span class='mw-ui-icon mw-ui-icon-element mw-ui-icon-reference-${ type }'></span>\n\t\t\t\t${ title }\n\t\t\t</strong>\n\t\t\t<div class='mwe-popups-extract'>\n\t\t\t\t<div class='mw-parser-output'>${ model.extract }</div>\n\t\t\t</div>\n\t\t\t<footer>\n\t\t\t\t<a href='${ url }' class='mwe-popups-read-link'>${ linkMsg }</a>\n\t\t\t</footer>\n\t\t`\n\t);\n\n\t// Make sure to not destroy existing targets, if any\n\t$el.find( '.mwe-popups-extract a[href]:not([target])' ).each( ( i, a ) => {\n\t\ta.target = '_blank';\n\t\t// Don't let the external site access and possibly manipulate window.opener.location\n\t\ta.rel = `${ a.rel ? `${ a.rel } ` : '' }noopener`;\n\t} );\n\n\tif ( model.sourceElementId ) {\n\t\t$el.find( '.mwe-popups-read-link' ).on( 'click', ( event ) => {\n\t\t\tevent.stopPropagation();\n\t\t\t$( `#${ $.escapeSelector( model.sourceElementId ) } > a` ).trigger( 'click' );\n\t\t} );\n\t}\n\n\t$el.find( '.mw-parser-output' ).on( 'scroll', function ( e ) {\n\t\tconst element = e.target,\n\t\t\tscrolledToBottom = element.scrollHeight === element.scrollTop + element.clientHeight;\n\n\t\tif ( !scrolledToBottom && element.isScrolling ) {\n\t\t\treturn;\n\t\t}\n\n\t\telement.isScrolling = !scrolledToBottom;\n\t\t$( element ).parent().toggleClass( 'mwe-popups-fade-out', element.isScrolling );\n\t} );\n\n\treturn $el;\n}\n","/**\n * @module settingsDialog\n */\n\nimport { escapeHTML } from '../templateUtil';\n\nconst $ = jQuery;\n\n/**\n * @typedef {Object} SettingsModel\n * @property {string} heading\n * @property {string} closeLabel\n * @property {string} saveLabel\n * @property {string} helpText\n * @property {string} okLabel\n * @property {SettingsChoiceModel[]} [choices]\n *\n * @global\n */\n\n/**\n * @typedef {Object} SettingsChoiceModel\n * @property {string} id Portion of the elements' IDs and value of the input.\n * @property {string} name\n * @property {string} [description]\n * @property {boolean} [isChecked] Whether the setting is checked.\n *\n * @global\n */\n\n/**\n * @param {SettingsChoiceModel[]} [choices]\n * @return {SettingsChoiceModel}\n */\nfunction escapeChoices( choices = [] ) {\n\treturn choices.map(\n\t\t( { id, name, description, isChecked } ) =>\n\t\t\t( {\n\t\t\t\tid: escapeHTML( id ),\n\t\t\t\tname: escapeHTML( name ),\n\t\t\t\tdescription: description ? escapeHTML( description ) : '',\n\t\t\t\tisChecked\n\t\t\t} )\n\t);\n}\n\n/**\n * @param {SettingsModel} model\n * @return {JQuery}\n */\nexport function renderSettingsDialog( model ) {\n\tconst heading = escapeHTML( model.heading ),\n\t\tsaveLabel = escapeHTML( model.saveLabel ),\n\t\tcloseLabel = escapeHTML( model.closeLabel ),\n\t\thelpText = escapeHTML( model.helpText ),\n\t\tokLabel = escapeHTML( model.okLabel ),\n\t\tchoices = escapeChoices( model.choices );\n\treturn $( $.parseHTML( `\n\t\t<section id='mwe-popups-settings'>\n\t\t\t<header>\n\t\t\t\t<div>\n\t\t\t\t\t<div class='mw-ui-icon mw-ui-icon-element mw-ui-icon-popups-close close'>${ closeLabel }</div>\n\t\t\t\t</div>\n\t\t\t\t<h1>${ heading }</h1>\n\t\t\t\t<div>\n\t\t\t\t\t<button class='save mw-ui-button mw-ui-progressive'>${ saveLabel }</button>\n\t\t\t\t\t<button class='okay mw-ui-button mw-ui-progressive' style='display:none;'>${ okLabel }</button>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<main id='mwe-popups-settings-form'>\n\t\t\t\t<form>\n\t\t\t\t\t${ choices.map( ( { id, name, description, isChecked } ) => `\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<input\n\t\t\t\t\t\t\tname='mwe-popups-setting'\n\t\t\t\t\t\t\t${ isChecked ? 'checked' : '' }\n\t\t\t\t\t\t\tvalue='${ id }'\n\t\t\t\t\t\t\ttype='radio'\n\t\t\t\t\t\t\tid='mwe-popups-settings-${ id }'>\n\t\t\t\t\t\t<label for='mwe-popups-settings-${ id }'>\n\t\t\t\t\t\t\t<span>${ name }</span>\n\t\t\t\t\t\t\t${ description }\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</p>` ).join( '' ) }\n\t\t\t\t</form>\n\t\t\t</main>\n\t\t\t<div class='mwe-popups-settings-help' style='display:none;'>\n\t\t\t\t<div class=\"mw-ui-icon mw-ui-icon-element mw-ui-icon-footer\"></div>\n\t\t\t\t<p>${ helpText }</p>\n\t\t\t</div>\n\t\t</section>\n\t`.trim() ) );\n}\n","/**\n * @module templateUtil\n */\n\nconst mw = mediaWiki;\n\n/**\n * @param {string} str\n * @return {string} The string with any HTML entities escaped.\n */\nexport function escapeHTML( str ) {\n\treturn mw.html.escape( str );\n}\n","/**\n * @module thumbnail\n */\n\nimport constants from '../constants';\n\nexport const SIZES = {\n\tportraitImage: {\n\t\th: 250, // Exact height\n\t\tw: 203 // Max width\n\t},\n\tlandscapeImage: {\n\t\th: 200, // Max height\n\t\tw: 320 // Exact Width\n\t}\n};\nconst $ = jQuery;\n\n/**\n * @typedef {Object} ext.popups.Thumbnail\n * @property {JQuery} el\n * @property {boolean} isTall Whether or not the thumbnail is portrait\n * @property {number} width\n * @property {number} height\n * @property {boolean} isNarrow whether the thumbnail is portrait and also\n *  thinner than the default portrait thumbnail width\n *  (as defined in SIZES.portraitImage.w)\n * @property {number} offset in pixels between the thumbnail width and the\n *  standard portrait thumbnail width (as defined in SIZES.portraitImage.w)\n */\n\n/**\n * Creates a thumbnail from the representation of a thumbnail returned by the\n * PageImages MediaWiki API query module.\n *\n * If there's no thumbnail, the thumbnail is too small, or the thumbnail's URL\n * contains characters that could be used to perform an\n * [XSS attack via CSS](https://www.owasp.org/index.php/Testing_for_CSS_Injection_(OTG-CLIENT-005)),\n * then `null` is returned.\n *\n * Extracted from `mw.popups.renderer.article.createThumbnail`.\n *\n * @param {Object} rawThumbnail\n * @return {ext.popups.Thumbnail|null}\n */\nexport function createThumbnail( rawThumbnail ) {\n\tconst devicePixelRatio = constants.BRACKETED_DEVICE_PIXEL_RATIO;\n\n\tif ( !rawThumbnail ) {\n\t\treturn null;\n\t}\n\n\tconst tall = rawThumbnail.width < rawThumbnail.height;\n\tconst thumbWidth = rawThumbnail.width / devicePixelRatio;\n\tconst thumbHeight = rawThumbnail.height / devicePixelRatio;\n\n\tif (\n\t\t// Image too small for landscape display\n\t\t( !tall && thumbWidth < SIZES.landscapeImage.w ) ||\n\t\t// Image too small for portrait display\n\t\t( tall && thumbHeight < SIZES.portraitImage.h ) ||\n\t\t// These characters in URL that could inject CSS and thus JS\n\t\t(\n\t\t\trawThumbnail.source.indexOf( '\\\\' ) > -1 ||\n\t\t\trawThumbnail.source.indexOf( '\\'' ) > -1 ||\n\t\t\trawThumbnail.source.indexOf( '\"' ) > -1\n\t\t)\n\t) {\n\t\treturn null;\n\t}\n\n\tlet x, y, width, height;\n\tif ( tall ) {\n\t\tx = ( thumbWidth > SIZES.portraitImage.w ) ?\n\t\t\t( ( thumbWidth - SIZES.portraitImage.w ) / -2 ) :\n\t\t\t( SIZES.portraitImage.w - thumbWidth );\n\t\ty = ( thumbHeight > SIZES.portraitImage.h ) ?\n\t\t\t( ( thumbHeight - SIZES.portraitImage.h ) / -2 ) : 0;\n\t\twidth = SIZES.portraitImage.w;\n\t\theight = SIZES.portraitImage.h;\n\n\t\t// Special handling for thin tall images\n\t\t// https://phabricator.wikimedia.org/T192928#4312088\n\t\tif ( thumbWidth < width ) {\n\t\t\tx = 0;\n\t\t\twidth = thumbWidth;\n\t\t}\n\t} else {\n\t\tx = 0;\n\t\ty = ( thumbHeight > SIZES.landscapeImage.h ) ?\n\t\t\t( ( thumbHeight - SIZES.landscapeImage.h ) / -2 ) : 0;\n\t\twidth = SIZES.landscapeImage.w;\n\t\theight = ( thumbHeight > SIZES.landscapeImage.h ) ?\n\t\t\tSIZES.landscapeImage.h : thumbHeight;\n\t}\n\n\tconst isNarrow = tall && thumbWidth < SIZES.portraitImage.w;\n\n\treturn {\n\t\tel: createThumbnailElement(\n\t\t\ttall ? 'mwe-popups-is-tall' : 'mwe-popups-is-not-tall',\n\t\t\trawThumbnail.source,\n\t\t\tx,\n\t\t\ty,\n\t\t\tthumbWidth,\n\t\t\tthumbHeight,\n\t\t\twidth,\n\t\t\theight\n\t\t),\n\t\tisTall: tall,\n\t\tisNarrow,\n\t\toffset: isNarrow ? SIZES.portraitImage.w - thumbWidth : 0,\n\t\twidth: thumbWidth,\n\t\theight: thumbHeight\n\t};\n}\n\n/**\n * Creates the SVG image element that represents the thumbnail.\n *\n * This function is distinct from `createThumbnail` as it abstracts away some\n * browser issues that are uncovered when manipulating elements across\n * namespaces.\n *\n * @param {string} className\n * @param {string} url\n * @param {number} x\n * @param {number} y\n * @param {number} thumbnailWidth\n * @param {number} thumbnailHeight\n * @param {number} width\n * @param {number} height\n * @return {JQuery}\n */\nexport function createThumbnailElement(\n\tclassName, url, x, y, thumbnailWidth, thumbnailHeight, width, height\n) {\n\tconst nsSvg = 'http://www.w3.org/2000/svg',\n\t\tnsXlink = 'http://www.w3.org/1999/xlink';\n\n\t// We want to visually separate the image from the summary\n\t// Given we use an SVG mask, we cannot rely on border to do this\n\t// and instead must insert a polyline element to visually separate\n\tconst line = document.createElementNS( nsSvg, 'polyline' );\n\tconst isTall = className.indexOf( 'not-tall' ) === -1;\n\tconst points = isTall ? [ 0, 0, 0, height ] :\n\t\t[ 0, height - 1, width, height - 1 ];\n\n\tline.setAttribute( 'stroke', 'rgba(0,0,0,0.1)' );\n\tline.setAttribute( 'points', points.join( ' ' ) );\n\tline.setAttribute( 'stroke-width', 1 );\n\n\tconst $thumbnailSVGImage = $( document.createElementNS( nsSvg, 'image' ) );\n\t$thumbnailSVGImage[ 0 ].setAttributeNS( nsXlink, 'href', url );\n\t$thumbnailSVGImage\n\t\t.addClass( className )\n\t\t.attr( {\n\t\t\tx,\n\t\t\ty,\n\t\t\twidth: thumbnailWidth,\n\t\t\theight: thumbnailHeight\n\t\t} );\n\n\tconst $thumbnail = $( document.createElementNS( nsSvg, 'svg' ) )\n\t\t.attr( {\n\t\t\txmlns: nsSvg,\n\t\t\twidth,\n\t\t\theight\n\t\t} )\n\t\t.append( $thumbnailSVGImage );\n\n\t$thumbnail.append( line );\n\treturn $thumbnail;\n}\n","/**\n * @module userSettings\n */\n\n/**\n * @interface UserSettings\n *\n * @global\n */\n\nconst IS_ENABLED_KEY = 'mwe-popups-enabled',\n\tPREVIEW_COUNT_KEY = 'ext.popups.core.previewCount';\n\n/**\n * Creates an object whose methods encapsulate all interactions with the UA's\n * storage.\n *\n * @param {Object} storage The `mw.storage` singleton instance\n *\n * @return {UserSettings}\n */\nexport default function createUserSettings( storage ) {\n\treturn {\n\t\t/**\n\t\t * Gets whether the user has previously enabled Page Previews.\n\t\t *\n\t\t * N.B. that if the user hasn't previously enabled or disabled Page\n\t\t * Previews, i.e. userSettings.setIsEnabled(true), then they are treated as\n\t\t * if they have enabled them.\n\t\t *\n\t\t * @function\n\t\t * @name UserSettings#getIsEnabled\n\t\t * @return {boolean}\n\t\t */\n\t\tgetIsEnabled() {\n\t\t\treturn storage.get( IS_ENABLED_KEY ) !== '0';\n\t\t},\n\n\t\t/**\n\t\t * Sets whether the user has enabled Page Previews.\n\t\t *\n\t\t * @function\n\t\t * @name UserSettings#setIsEnabled\n\t\t * @param {boolean} isEnabled\n\t\t * @return {void}\n\t\t */\n\t\tsetIsEnabled( isEnabled ) {\n\t\t\tstorage.set( IS_ENABLED_KEY, isEnabled ? '1' : '0' );\n\t\t},\n\n\t\t/**\n\t\t * Gets whether the user has previously enabled **or disabled** Page\n\t\t * Previews.\n\t\t *\n\t\t * @function\n\t\t * @name UserSettings#hasIsEnabled\n\t\t * @return {boolean}\n\t\t */\n\t\thasIsEnabled() {\n\t\t\tconst value = storage.get( IS_ENABLED_KEY );\n\n\t\t\treturn Boolean( value ) !== false;\n\t\t},\n\n\t\t/**\n\t\t * Gets the number of previews that the user has seen.\n\t\t *\n\t\t * - If the storage isn't available, then -1 is returned.\n\t\t * - If the value in storage is not a number it will override stored value\n\t\t *   to 0\n\t\t *\n\t\t * @function\n\t\t * @name UserSettings#getPreviewCount\n\t\t * @return {number}\n\t\t */\n\t\tgetPreviewCount() {\n\t\t\tconst result = storage.get( PREVIEW_COUNT_KEY );\n\n\t\t\tif ( result === false ) {\n\t\t\t\treturn -1;\n\t\t\t} else if ( result === null ) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tlet count = parseInt( result, 10 );\n\n\t\t\t// stored number is not a zero, override it to zero and store new value\n\t\t\tif ( isNaN( count ) ) {\n\t\t\t\tcount = 0;\n\t\t\t\tthis.setPreviewCount( count );\n\t\t\t}\n\t\t\treturn count;\n\t\t},\n\n\t\t/**\n\t\t * Sets the number of previews that the user has seen.\n\t\t *\n\t\t * @function\n\t\t * @name UserSettings#setPreviewCount\n\t\t * @param {number} count\n\t\t * @return {void}\n\t\t */\n\t\tsetPreviewCount( count ) {\n\t\t\tstorage.set( PREVIEW_COUNT_KEY, count.toString() );\n\t\t}\n\t};\n}\n","/**\n * @module wait\n */\n\nconst $ = jQuery;\n\n/**\n * A Promise usually for a long running or costly request that is abortable.\n * @template T\n * @typedef {JQuery.Promise<T>} AbortPromise\n * @prop {Function(): void} abort\n */\n\n/**\n * Sugar around `window.setTimeout`.\n *\n * @example\n * import wait from './wait';\n *\n * wait( 150 )\n *   .then( () => {\n *     // Continue processing...\n *   } );\n *\n * @param {number} delay The number of milliseconds to wait\n * @return {AbortPromise<void>}\n */\nexport default function wait( delay ) {\n\tconst deferred = $.Deferred();\n\n\tconst timer = setTimeout( () => {\n\t\tdeferred.resolve();\n\t}, delay );\n\tdeferred.catch( () => clearTimeout( timer ) );\n\n\treturn deferred.promise( {\n\t\tabort() {\n\t\t\tdeferred.reject();\n\t\t}\n\t} );\n}\n"],"sourceRoot":""}